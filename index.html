<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sistema de Examen Interactivo</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    <style>
        :root {
            --primary: #5e35b1;
            --primary-dark: #4527a0;
            --primary-light: #d1c4e9;
            --secondary: #3949ab;
            --success: #43a047;
            --success-light: #e8f5e9;
            --danger: #e53935;
            --danger-light: #ffebee;
            --warning: #fb8c00;
            --warning-light: #fff3e0;
            --info: #039be5;
            --info-light: #e1f5fe;
            --light: #f5f5f5;
            --light-gray: #eceff1;
            --gray: #78909c;
            --dark: #263238;
            --white: #ffffff;
            --shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 4px 8px rgba(0, 0, 0, 0.15);
            --transition: all 0.2s ease;
            --border-radius: 6px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--light-gray);
            color: var(--dark);
            line-height: 1.6;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            touch-action: manipulation;
        }

        .container {
            max-width: 800px;
            width: 100%;
            margin: 0 auto;
            padding: 20px;
        }

        .main-container {
            max-width: 700px;
            margin: 0 auto;
            width: 100%;
        }

        .fade-enter-active,
        .fade-leave-active {
            transition: opacity 0.3s ease;
        }

        .fade-enter-from,
        .fade-leave-to {
            opacity: 0;
        }

        .card {
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 25px;
            margin-bottom: 20px;
            width: 100%;
        }

        .card-header {
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            padding-bottom: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .card-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--primary);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            font-weight: 500;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            outline: none;
            font-size: 0.95rem;
        }

        .btn-sm {
            padding: 8px 15px;
            font-size: 0.85rem;
        }

        .btn-primary {
            background-color: var(--primary);
            color: var(--white);
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            box-shadow: var(--shadow-hover);
        }

        .btn-secondary {
            background-color: var(--secondary);
            color: var(--white);
        }

        .btn-success {
            background-color: var(--success);
            color: var(--white);
        }

        .btn-danger {
            background-color: var(--danger);
            color: var(--white);
        }

        .btn-warning {
            background-color: var(--warning);
            color: var(--white);
        }

        .btn-info {
            background-color: var(--info);
            color: var(--white);
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background-color: var(--primary);
            color: var(--white);
        }

        .btn-disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .form-control {
            -webkit-user-select: text !important;
            user-select: text !important;
            -webkit-tap-highlight-color: rgba(0,0,0,0);
            width: 100%;
            max-width: 400px;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background-color: var(--white);
            margin: 0 auto;
        }

        .form-control:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(94, 53, 177, 0.2);
            outline: none;
        }

        .alert {
            padding: 12px 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            border-left: 4px solid transparent;
            font-size: 0.95rem;
        }

        .alert-success {
            background-color: var(--success-light);
            border-color: var(--success);
            color: #2e7d32;
        }

        .alert-danger {
            background-color: var(--danger-light);
            border-color: var(--danger);
            color: #c62828;
        }

        .alert-warning {
            background-color: var(--warning-light);
            border-color: var(--warning);
            color: #e65100;
        }

        .alert-info {
            background-color: var(--info-light);
            border-color: var(--info);
            color: #0277bd;
        }

        .progress {
            height: 6px;
            background-color: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--primary);
            transition: width 0.6s ease;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--white);
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            padding-bottom: 15px;
            margin-bottom: 15px;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary);
        }

        .modal-body {
            margin-bottom: 20px;
            color: var(--gray);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .question-container {
            background-color: var(--light);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.15rem;
            font-weight: 500;
            margin-bottom: 15px;
            color: var(--dark);
            word-wrap: break-word;
            white-space: normal;
        }

        .answers-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .answer-option {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-radius: var(--border-radius);
            background-color: var(--white);
            border: 1px solid #ddd;
            cursor: pointer;
            transition: var(--transition);
        }

        .answer-option.selected {
            border-color: var(--primary);
            background-color: var(--primary-light);
        }

        .answer-option.correct {
            border-color: var(--success);
            background-color: var(--success-light);
        }

        .answer-option.incorrect {
            border-color: var(--danger);
            background-color: var(--danger-light);
        }

        .answer-option.partially-correct {
            border-color: var(--warning);
            background-color: var(--warning-light);
        }

        .answer-letter {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-weight: 600;
            background-color: var(--light);
            color: var(--dark);
            flex-shrink: 0;
            font-size: 0.9rem;
        }

        .answer-option.selected .answer-letter {
            background-color: var(--primary);
            color: var(--white);
        }

        .answer-option.correct .answer-letter {
            background-color: var(--success);
            color: var(--white);
        }

        .answer-option.incorrect .answer-letter {
            background-color: var(--danger);
            color: var(--white);
        }

        .answer-option.partially-correct .answer-letter {
            background-color: var(--warning);
            color: var(--white);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .result-card {
            background-color: var(--white);
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .result-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .result-label {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--success);
            color: var(--white);
            padding: 12px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-hover);
            display: flex;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            transform: translateY(100%);
            transition: var(--transition);
        }

        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        .notification-icon {
            margin-right: 10px;
        }

        .text-center {
            text-align: center;
        }

        .text-primary {
            color: var(--primary);
        }

        .text-success {
            color: var(--success);
        }

        .text-danger {
            color: var(--danger);
        }

        .text-warning {
            color: var(--warning);
        }

        .text-info {
            color: var(--info);
        }

        .text-gray {
            color: var(--gray);
        }

        .font-bold {
            font-weight: 600;
        }

        .mt-2 {
            margin-top: 8px;
        }

        .mt-4 {
            margin-top: 16px;
        }

        .mb-2 {
            margin-bottom: 8px;
        }

        .mb-3 {
            margin-bottom: 12px;
        }

        .mb-4 {
            margin-bottom: 16px;
        }

        .ml-2 {
            margin-left: 8px;
        }

        .ml-4 {
            margin-left: 16px;
        }

        .mr-2 {
            margin-right: 8px;
        }

        .flex {
            display: flex;
        }

        .flex-col {
            flex-direction: column;
        }

        .items-center {
            align-items: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .justify-center {
            justify-content: center;
        }

        .gap-4 {
            gap: 16px;
        }

        .space-y-2 > * + * {
            margin-top: 8px;
        }

        .space-y-4 > * + * {
            margin-top: 16px;
        }

        .space-x-2 > * + * {
            margin-left: 8px;
        }

        .grid {
            display: grid;
        }

        .grid-cols-1 {
            grid-template-columns: repeat(1, minmax(0, 1fr));
        }

        .grid-cols-2 {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }

        .block {
            display: block;
        }

        .rounded-lg {
            border-radius: var(--border-radius);
        }

        .bg-gray-100 {
            background-color: #f7f7f7;
        }

        .p-3 {
            padding: 12px;
        }

        .p-5 {
            padding: 20px;
        }

        .text-sm {
            font-size: 0.85rem;
        }

        .text-lg {
            font-size: 1.125rem;
        }

        .text-xl {
            font-size: 1.25rem;
        }

        .text-2xl {
            font-size: 1.5rem;
        }

        .map-container {
            width: 100%;
            height: 300px;
            margin: 20px 0;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            position: relative;
        }

        .map-placeholder {
            width: 100%;
            height: 100%;
            background-color: var(--light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray);
        }

        /* Estilos para el select de circunscripción */
        .circunscripcion-select {
            width: 100%;
            max-width: 400px;
            margin: 20px auto;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background-color: var(--white);
        }

        .circunscripcion-select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(94, 53, 177, 0.2);
            outline: none;
        }

        .circunscripcion-display {
            font-size: 1.5rem;
            font-weight: bold;
            color: #e53935;
            text-align: center;
            margin: 20px 0;
            padding: 10px;
            border: 2px solid #e53935;
            border-radius: var(--border-radius);
            background-color: #ffebee;
        }

        /* Estilos para móviles */
        @media (max-width: 768px) {
            .card {
                padding: 15px;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
                padding: 15px;
            }
            
            .grid-cols-2 {
                grid-template-columns: 1fr;
            }
            
            .question-text {
                font-size: 1rem;
            }
            
            .answer-option {
                padding: 10px 12px;
            }
            
            .btn {
                padding: 8px 16px;
                font-size: 0.9rem;
            }
            
            .circunscripcion-display {
                font-size: 1.2rem;
                padding: 8px;
            }
            
            /* Corrección específica para el campo de entrada en móviles */
            .form-control {
                -webkit-user-select: text !important;
                user-select: text !important;
                -webkit-tap-highlight-color: rgba(0,0,0,0);
                touch-action: manipulation;
                font-size: 16px;
                min-height: 44px;
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
            }
            
            input, textarea {
                font-size: 16px;
            }
            
            input[type="text"] {
                caret-color: transparent;
            }
            
            .form-control:focus {
                -webkit-user-select: text;
                user-select: text;
                caret-color: auto;
            }
            
            .show-keyboard-btn {
                margin-top: 10px;
                padding: 8px 12px;
                font-size: 0.9rem;
            }
        }

        /* Estilos para impresión */
        @media print {
            body * {
                visibility: hidden;
            }
            #app .card, #app .card * {
                visibility: visible;
            }
            #app .card {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
                padding: 10px;
                margin: 0;
            }
            .results-grid {
                display: flex !important;
                flex-direction: row !important;
                gap: 10px;
                margin-bottom: 15px;
            }
            .result-card {
                padding: 10px;
                flex: 1;
            }
            .result-value {
                font-size: 1.5rem;
            }
            .no-print {
                display: none !important;
            }
        }
        
        .download-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--info);
            color: white;
            padding: 12px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-hover);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
            max-width: 90%;
            text-align: center;
        }
        
        .download-notification.show {
            opacity: 1;
        }
        
        .download-notification-icon {
            margin-right: 8px;
        }
        
        .force-keyboard {
            position: fixed;
            top: -100px;
            left: -100px;
            width: 1px;
            height: 1px;
            opacity: 0;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div id="app">
            <input type="text" class="force-keyboard" ref="hiddenInput">
            
            <div class="modal" :class="{show: showLocationModal}">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title">Ubicación Requerida</h3>
                    </div>
                    <div class="modal-body">
                        <p>Para continuar con el examen, necesitamos acceder a tu ubicación. Esto nos ayuda a garantizar la integridad del proceso.</p>
                        <div v-if="locationError" class="alert alert-danger mt-3">
                            {{ locationError }}
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button @click="cancelExam" class="btn btn-outline">Cancelar</button>
                        <button @click="requestLocation" class="btn btn-primary">Compartir Ubicación</button>
                    </div>
                </div>
            </div>

            <transition name="fade">
                <div v-if="showConfig && isAdmin" class="card">
                    <div class="card-header">
                        <h2 class="card-title">Configuración del Examen</h2>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="block mb-2 font-medium">Hora de inicio:</label>
                            <input v-model="examConfig.startTime" type="time" class="form-control">
                        </div>
                        <div>
                            <label class="block mb-2 font-medium">Hora de fin:</label>
                            <input v-model="examConfig.endTime" type="time" class="form-control">
                        </div>
                        <div>
                            <label class="block mb-2 font-medium">Duración (minutos):</label>
                            <input v-model="examConfig.duration" type="number" min="1" class="form-control">
                        </div>
                        <div>
                            <label class="block mb-2 font-medium">Número de preguntas:</label>
                            <input v-model="examConfig.numQuestions" type="number" min="5" max="50" class="form-control">
                        </div>
                        <div>
                            <label class="block mb-2 font-medium">Proteger preguntas:</label>
                            <select v-model="examConfig.protectQuestions" class="form-control">
                                <option :value="true">Sí</option>
                                <option :value="false">No</option>
                            </select>
                        </div>
                        <div>
                            <label class="block mb-2 font-medium">Ubicación obligatoria:</label>
                            <select v-model="examConfig.requireLocation" class="form-control">
                                <option :value="true">Sí</option>
                                <option :value="false">No</option>
                            </select>
                        </div>
                    </div>
                    <div class="text-center">
                        <button @click="saveConfig" class="btn btn-success">Guardar Configuración</button>
                    </div>
                </div>
            </transition>

            <transition name="fade">
                <div v-if="currentScreen === 'code'" class="card">
                    <div class="card-header">
                        <h2 class="card-title">Ingrese su código de acceso</h2>
                        <h4 class="card-title">todos los grupos estan en esta area</h4>
                    </div>
                    
                    <div v-if="!isExamTime" class="alert alert-warning">
                        <p v-if="timeUntilStart > 0">El examen comenzará en: <strong class="text-primary">{{ formatCountdown(timeUntilStart) }}</strong></p>
                        <p v-else-if="timeUntilEnd <= 0">El examen ha finalizado. Próximo examen: {{ examConfig.startTime }}</p>
                        <p v-else>Horario permitido: {{ examConfig.startTime }} - {{ examConfig.endTime }}</p>
                    </div>
                    
                    <div v-if="hasCompletedExam && isExamTime" class="alert alert-info">
                        <p class="font-bold">¡Ya completaste el examen!</p>
                        <p>Tu calificación: <strong>{{ lastExamScore }}%</strong></p>
                        <p v-if="attemptNumber >= 2">Has agotado tus 2 intentos permitidos.</p>
                    </div>
                    
                    <div class="flex flex-col items-center">
                        <input 
                            v-model="enteredCode"
                            @input="handleCodeInput"
                            @keyup.enter="verifyCode"
                            :disabled="isCodeBlocked || !isExamTime || (hasCompletedExam && attemptNumber >= 2)"
                            type="text" 
                            class="form-control mb-4 text-center"
                            placeholder="Ingrese su código"
                            ref="codeInput"
                            inputmode="text"
                            autocomplete="off"
                            autocorrect="off"
                            spellcheck="false"
                            autocapitalize="characters">
                        
                        <div v-if="isCodeBlocked" class="text-center mb-4">
                            <p class="text-danger mb-2">Código incorrecto. Espere:</p>
                            <div class="text-2xl font-bold text-danger">{{ countdown }} segundos</div>
                        </div>
                        
                        <button 
                            @click="verifyCode"
                            :disabled="isCodeBlocked || !isExamTime || (hasCompletedExam && attemptNumber >= 2)"
                            class="btn btn-primary">
                            Continuar
                        </button>
                        
                        <button 
                            v-if="isMobileDevice"
                            @click="showKeyboard"
                            class="btn btn-outline show-keyboard-btn mt-4">
                            Mostrar Teclado
                        </button>
                        
                        <button 
                            v-if="developmentMode"
                            @click="toggleAdmin"
                            class="btn btn-outline mt-4">
                            {{ isAdmin ? 'Desactivar Admin' : 'Activar Admin' }}
                        </button>
                    </div>
                </div>
            </transition>

            <transition name="fade">
                <div v-if="currentScreen === 'user-info'" class="card">
                    <div class="card-header">
                        <h2 class="card-title">Verifique su información</h2>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="block mb-2 font-medium">Cédula:</label>
                            <div class="p-3 bg-gray-100 rounded-lg">{{ currentUser.ci }}</div>
                        </div>
                        <div>
                            <label class="block mb-2 font-medium">Nombre:</label>
                            <div class="p-3 bg-gray-100 rounded-lg">{{ currentUser.nombre }}</div>
                        </div>
                        <div>
                            <label class="block mb-2 font-medium">Correo:</label>
                            <div class="p-3 bg-gray-100 rounded-lg">{{ currentUser.correo }}</div>
                        </div>
                        <div>
                            <label class="block mb-2 font-medium">Código:</label>
                            <div class="p-3 bg-gray-100 rounded-lg">{{ currentUser.codigo }}</div>
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <label class="block mb-2 font-medium">Seleccione su circunscripción:</label>
                        <select 
                            v-model="selectedCircunscripcion"
                            class="circunscripcion-select"
                            required>
                            <option value="" disabled selected>-- Seleccione una opción --</option>
                            <option value="C20">C20</option>
                            <option value="C21">C21</option>
                            <option value="C22">C22</option>
                            <option value="C23">C23</option>
                            <option value="C28">C28</option>
                            <option value="C2">C2</option>
                            <option value="C24">C24</option>
                            <option value="C25">C25</option>
                            <option value="C26">C26</option>
                            <option value="C27">C27</option>
                        </select>
                        
                        <div v-if="selectedCircunscripcion" class="circunscripcion-display">
                            Circunscripción seleccionada: {{ selectedCircunscripcion }}
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <p class="mb-4">
                            <b>Por favor verifique que esta información es correcta antes de comenzar.</b>
                            <br>
                            <b>Las respuestas a las preguntas son de selección multiple(1 o mas respuestas, en caso de responder parcialmente la respuesta se considera erronea)</b>
                        </p>
                        <p class="text-sm text-gray-500 mb-4">Duración del examen: {{ examConfig.duration }} minutos</p>
                        <p class="text-sm text-gray-500 mb-4" v-if="attemptNumber > 1">Intento #{{ attemptNumber}} de 2</p>
                        <button 
                            @click="verifyAndStartExam" 
                            :disabled="!selectedCircunscripcion"
                            class="btn btn-success">
                            Confirmar y comenzar
                        </button>
                    </div>
                </div>
            </transition>

            <transition name="fade">
                <div v-if="currentScreen === 'exam'" class="card">
                    <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-6">
                        <div class="mb-4 md:mb-0">
                            <h2 class="text-xl font-bold text-primary">Examen Interactivo</h2>
                            <p class="text-sm text-gray-500">Tiempo restante: <span class="font-bold">{{ formatTime(timeLeft) }}</span></p>
                        </div>
                        <div class="flex space-x-2">
                            <span class="badge badge-primary">
                                Pregunta {{ currentQuestionIndex + 1 }} de {{ selectedQuestions.length }}
                            </span>
                            <span class="badge badge-secondary">
                                Intento #{{ attemptNumber }}
                            </span>
                        </div>
                    </div>
                    
                    <div class="question-container">
                        <div v-if="examConfig.protectQuestions">
                            <img :src="currentQuestionImage" class="w-full h-auto mb-4 rounded-lg" alt="Pregunta">
                        </div>
                        <h3 v-else class="question-text">{{ currentQuestion.text }}</h3>
                    </div>
                    
                    <div class="answers-container">
                        <div 
                            v-for="(answer, index) in currentQuestion.answers" 
                            :key="index"
                            @click="toggleAnswer(index)"
                            class="answer-option"
                            :class="{
                                'selected': selectedAnswers.includes(index) && !showFeedback,
                                'correct': showFeedback && answer.correct,
                                'incorrect': showFeedback && selectedAnswers.includes(index) && !answer.correct,
                                'partially-correct': showFeedback && answer.correct && selectedAnswers.includes(index) && !allCorrectAnswersSelected
                            }">
                            <div class="answer-letter">
                                {{ String.fromCharCode(65 + index) }}
                            </div>
                            <div>{{ answer.text }}</div>
                        </div>
                    </div>
                    
                    <div class="flex flex-col md:flex-row md:justify-center md:items-center mt-6 gap-4">
                        <div v-if="showFeedback" class="text-center">
                            <p v-if="answerIsFullyCorrect" class="text-success font-bold">¡Respuesta correcta!</p>
                            <p v-else-if="answerIsPartiallyCorrect" class="text-warning font-bold">Parcialmente correcta</p>
                            <p v-else class="text-danger font-bold">Incorrecto. Respuestas correctas: {{ correctAnswersText }}</p>
                        </div>
                        
                        <button 
                            v-if="!showFeedback && selectedAnswers.length > 0"
                            @click="checkAnswer"
                            class="btn btn-primary">
                            Verificar
                        </button>
                        <button 
                            v-if="showFeedback"
                            @click="nextQuestion"
                            class="btn btn-primary">
                            {{ isLastQuestion ? 'Finalizar examen' : 'Siguiente' }}
                        </button>
                    </div>
                    
                    <div class="mt-6">
                        <div class="flex justify-between mb-2 text-sm">
                            <span>Progreso: {{ Math.round((currentQuestionIndex / selectedQuestions.length) * 100) }}%</span>
                            <span>Tiempo: {{ formatTime(elapsedTime) }}</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar" :style="{ width: `${(currentQuestionIndex / selectedQuestions.length) * 100}%` }"></div>
                        </div>
                    </div>
                </div>
            </transition>

            <transition name="fade">
                <div v-if="currentScreen === 'results'" class="card">
                    <div class="text-center mb-8">
                        <h2 class="text-2xl font-bold text-primary mb-2">Resultados del Examen</h2>
                        <p class="text-lg">Gracias por completar el examen, {{ currentUser.nombre }}!</p>
                        <p class="text-sm text-gray-500">Intento #{{ attemptNumber }} - {{ new Date().toLocaleString() }}</p>
                    </div>
                    
                    <div class="results-grid">
                        <div class="result-card">
                            <div class="result-value text-primary">{{ score }}%</div>
                            <div class="result-label">Puntuación</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value text-success">{{ correctAnswersCount.toFixed(1) }}</div>
                            <div class="result-label">Respuestas correctas</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value text-secondary">{{ formatTime(examResults?.time || elapsedTime) }}</div>
                            <div class="result-label">Tiempo empleado</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value text-info">{{ selectedCircunscripcion }}</div>
                            <div class="result-label">Circunscripción</div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-5 rounded-lg mb-6">
                        <h3 class="text-lg font-semibold mb-4">Información del Examen</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <p class="font-medium">Inicio:</p>
                                <p>{{ formatDateTime(examStartTime) }}</p>
                            </div>
                            <div>
                                <p class="font-medium">Finalización:</p>
                                <p>{{ formatDateTime(examFinishTime) }}</p>
                            </div>
                            <div v-if="examLocation">
                                <p class="font-medium">Ubicación:</p>
                                <p>Lat: {{ examLocation.latitude.toFixed(6) }}, Long: {{ examLocation.longitude.toFixed(6) }}</p>
                            </div>
                            <div v-if="locationError">
                                <p class="font-medium text-danger">Error:</p>
                                <p>{{ locationError }}</p>
                            </div>
                            <div>
                                <p class="font-medium">Dispositivo:</p>
                                <p>{{ isMobileDevice ? 'Móvil' : 'Computadora' }}</p>
                            </div>
                            <div>
                                <p class="font-medium">Circunscripción:</p>
                                <p>{{ selectedCircunscripcion }}</p>
                            </div>
                        </div>
                        
                        <div v-if="examLocation" class="mt-4">
                            <h4 class="font-medium mb-2">Ubicación aproximada:</h4>
                            <div class="map-container">
                                <div id="leaflet-map" style="width: 100%; height: 100%;"></div>
                            </div>
                            <p class="text-sm text-gray-500 mt-2">Esta ubicación se incluirá en el certificado</p>
                        </div>
                        <div v-else-if="locationError" class="map-container">
                            <div class="map-placeholder">
                                <p>No se pudo obtener la ubicación</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <button @click="downloadResults" class="btn btn-primary">
                            Descargar Certificado
                        </button>
                        <button @click="returnToStart" class="btn btn-outline mt-4" v-if="attemptNumber < 2">
                            Intentar nuevamente
                        </button>
                    </div>
                </div>
            </transition>

            <div class="download-notification" :class="{show: showAutoDownloadNotification}">
                <svg class="download-notification-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                <span>Se ha descargado automáticamente tu certificado en PDF</span>
            </div>

            <div class="notification" :class="{show: showDownloadNotification}">
                <svg class="notification-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                </svg>
                <span>PDF descargado correctamente</span>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>

    <script>
        const { createApp, ref, computed, onMounted, onUnmounted, nextTick } = Vue;
        
        createApp({
            setup() {
                // Modo desarrollo
                const developmentMode = window.location.href.startsWith('file://') || 
                                      window.location.hostname === 'localhost' || 
                                      window.location.hostname === '127.0.0.1';
                
                // Configuración del examen
                const examConfig = ref({
                    startTime: '15:00',
                    endTime: '16:01',
                    duration: 7,
                    numQuestions: 10,
                    protectQuestions: true,
                    requireLocation: true
                }); 
                
                // Datos de usuarios (simulados para desarrollo)
                const signal = ref([
  {
    "ci": "8763481",
    "nombre": "EUGENIA MARZANA HEREDIA",
    "correo": "eugeniamarzanaheredia@gmail.com",
    "codigo": "TED-CBB-E64929"
  },
  {
    "ci": "9388938",
    "nombre": "BENITO FERNANDEZ CORO",
    "correo": "benitezkorys@gmail.com",
    "codigo": "TED-CBB-4B642D"
  },                  
  {
    "ci": "8733030",
    "nombre": "SOTO nan MIRIAM CECILIA",
    "correo": "sotomiriamcecilia@gmail.com",
    "codigo": "TED-CBB-02AE7B"
  },
  {
    "ci": "8772819",
    "nombre": "HUMACATA BECERRA SUSI",
    "correo": "susi.hb19@gmail.com",
    "codigo": "TED-CBB-31F634"
  },
  {
    "ci": "13162638",
    "nombre": "BALLESTEROS FERNANDEZ MARLENE",
    "correo": "marleneballesteros7@gmail.com",
    "codigo": "TED-CBB-6BB6C6"
  },
  {
    "ci": "12404655",
    "nombre": "VALLES ALTAMIRANO JHANCARLA",
    "correo": "vallesjhancarla95@gmail.com",
    "codigo": "TED-CBB-919C3D"
  },
  {
    "ci": "6556499",
    "nombre": "VALENCIA VARGAS FERNANDO",
    "correo": "fernandovalenciavargas97@gmail.com",
    "codigo": "TED-CBB-E36004"
  },
  {
    "ci": "9523800",
    "nombre": "CHAMBILLA CHOQUE JIMENA",
    "correo": "jimenachambilla20@gmail.com",
    "codigo": "TED-CBB-737A28"
  },
 
  {
    "ci": "9334207",
    "nombre": "ALEJANDRA IBAÑEZ CHACON",
    "correo": "202109339@est.umss.edu",
    "codigo": "TED-CBB-0E4359"
  },
  {
    "ci": "8799203",
    "nombre": "REVOLLO VICKER YERKO RICARDO",
    "correo": "201910237@est.umss.edu",
    "codigo": "TED-CBB-458FF7"
  },
  {
    "ci": "8799203-1I",
    "nombre": "REVOLLO VICKER YERKO RICARDO",
    "correo": "201910237@est.umss.edu",
    "codigo": "TED-CBB-458FF7"
  },
  {
    "ci": "5269511",
    "nombre": "CUBA ROMERO Max Fernando",
    "correo": "fernandocubaromero123@gmail.com",
    "codigo": "TED-CBB-89D384"
  },
  {
    "ci": "12649922",
    "nombre": "ROJAS COLQUE JOSIAS",
    "correo": "josiiirojas@gmail.com",
    "codigo": "TED-CBB-4CAA29"
  },
  {
    "ci": "5311763",
    "nombre": "GUSTAVO ADOLFO FUENTES AGREDA",
    "correo": "adolfo110gustavo@gmail.com",
    "codigo": "TED-CBB-2d6c87"
  },
  {
    "ci": "14947536",
    "nombre": "NICO SIRPITA QUISPE",
    "correo": "nicolsirpa0@gmail.com",
    "codigo": "TED-CBB-766D5D"
  },
  {
    "ci": "6472100",
    "nombre": "VICENTE FRANCO QUIROZ",
    "correo": "vifranco1990@gmail.com",
    "codigo": "TED-CBB-DB7CF8"
  },
  {
    "ci": "14214766",
    "nombre": "MARIBEL QUISPE RIOS",
    "correo": "mq0134555@gmail.com",
    "codigo": "TED-CBB-E270C4"
  },
  {
    "ci": "6495584",
    "nombre": "PATRICIA LAMES FLORES",
    "correo": "patricialam45y@gmail.com",
    "codigo": "TED-CBB-F78F5C"
  },
  {
    "ci": "9368144",
    "nombre": "BETTY AMAYA PEREZ",
    "correo": "ayamabetty@gmail.com",
    "codigo": "TED-CBB-BE3914"
  },
  {
    "ci": "14815710",
    "nombre": "JESSICA MENESES MORALES",
    "correo": "jessicameneses369@gmail.com",
    "codigo": "TED-CBB-7EE073"
  }
                ])
                // Banco de preguntas
                const questionBank = ref([
  {
    text: "1.    ¿En qué fecha se realizará la Elección de Autoridades y Representantes del Estado Plurinacional de Bolivia 2025?",
    answers: [
      { text: "a)    16 de agosto", correct: false },
      { text: "b)    10 de agosto", correct: false },
      { text: "c)    17 de agosto", correct: true },
    ]
  },
  {
    text: "2.    ¿Cuántos asientos electorales se habilitarán en los países del exterior para la Elección de Autoridades y Representantes del Estado Plurinacional de Bolivia 2025?",
    answers: [
      { text: "a)    25 países", correct: false },
      { text: "b)    32 países", correct: true },
      { text: "c)    30 países", correct: false },
    ]
  },
  {
    text: "3.    ¿Cuántos representantes titulares ante organismos parlamentarios supraestatales se elegirán en las elecciones generales?",
    answers: [
      { text: "a)    10 parlamentarios", correct: false },
      { text: "b)    8 parlamentarios", correct: false },
      { text: "c)    9 parlamentarios", correct: true },
    ]
  },
  {
    text: "4.    ¿En cuántas circunscripciones especiales indígena originario campesinas se elegirán a los diputados de las NPIOC?",
    answers: [
      { text: "a)    5 circunscripciones especiales", correct: false },
      { text: "b)    7 circunscripciones especiales", correct: true },
      { text: "c)    9 circunscripciones especiales", correct: false },
    ]
  },
  {
    text: "5.    ¿Cuántas senadoras y senadores titulares se elegirán por departamento?",
    answers: [
      { text: "a)    4 senadoras y senadores titulares por departamento", correct: true },
      { text: "b)    6 senadoras y senadores titulares por departamento", correct: false },
      { text: "c)    12 senadoras y senadores titulares por departamento", correct: false },
    ]
  },
  {
    text: "6.    ¿Cuántas senadoras y senadores titulares se elegirán a nivel nacional?",
    answers: [
      { text: "a)    30 senadoras y senadores titulares a nivel nacional", correct: false },
      { text: "b)    35 senadoras y senadores titulares a nivel nacional", correct: false },
      { text: "c)    36 senadoras y senadores titulares a nivel nacional", correct: true },
    ]
  },
  {
    text: "7.    ¿Cuántos diputados plurinacionales titulares se elegirán a nivel nacional?",
    answers: [
      { text: "a)    30 diputados plurinacionales titulares", correct: false },
      { text: "b)    70 diputados plurinacionales titulares", correct: false },
      { text: "c)    60 diputados plurinacionales titulares", correct: true },
    ]
  },
  {
    text: "8.    ¿Cuántos diputados uninominales titulares se elegirán a nivel nacional?",
    answers: [
      { text: "a)    60 diputados uninominales titulares", correct: false },
      { text: "b)    63 diputados uninominales titulares", correct: true },
      { text: "c)    70 diputados uninominales titulares", correct: false },
    ]
  },
  {
    text: "9.    ¿Cuántas papeletas de sufragio se utilizarán en la Elección de Autoridades y Representantes del Estado Plurinacional de Bolivia 2025?",
    answers: [
      { text: "a)    3 papeletas de sufragio", correct: false },
      { text: "b)    2 papeletas de sufragio", correct: false },
      { text: "c)    1 papeleta de sufragio", correct: true },
    ]
  },
  {
    text: "10. ¿Cuántas hojas de trabajo se utilizarán en la Elección de Autoridades y Representantes del Estado Plurinacional de Bolivia 2025?",
    answers: [
      { text: "a)    5 hojas de trabajo", correct: false },
      { text: "b)    2 hojas de trabajo", correct: true },
      { text: "c)    1 hoja de trabajo", correct: false },
    ]
  },
  {
    text: "11. ¿Por quiénes son designados las notarias y los notarios electorales?",
    answers: [
      { text: "a)    Tribunal Electoral Departamental de Cochabamba", correct: true },
      { text: "b)    Tribunal Supremo Electoral", correct: false },
      { text: "c)    Jueces Electorales", correct: false },
    ]
  },
  {
    text: "12. ¿Qué funciones principales cumplen las notarias y los notarios electorales?",
    answers: [
      { text: "a)    Función de capacitación a los jueces electorales", correct: false },
      { text: "b)    Función de apoyo logístico y operativo", correct: true },
      { text: "c)    Función de monitoreo a las guías electorales", correct: false },
    ]
  },
  {
    text: "13. Señale una de las atribuciones que cumplen las notarías y los notarios electorales.",
    answers: [
      { text: "a)    Apoyar en la planificación de actividades de las y los jurados electorales de las mesas de sufragio y asistir en la capacitación.", correct: false },
      { text: "b)    Asistir a la organización de las y los jurados electorales de las mesas de sufragio y apoyar en la capacitación e información electoral.", correct: true },
      { text: "c)    Coadyuvar a la organización de las jueces y los jueces electorales, el día de la votación.", correct: false },
    ]
  },
  {
    text: "14. Indique una de las responsabilidades establecidas para las notarías y los notarios electorales por el Reglamento para las Elecciones Gene­rales 2025.",
    answers: [
      { text: "a)    Asistencia, información y capacitación a las jueces y los jueces electorales, de acuerdo con las directrices emitidas por los Tribunales Electorales Departamentales.", correct: false },
      { text: "b)    Brindar capacitación a las ciudadanas y los ciudadanos, de acuerdo con las directrices emitidas por los Tribunales Electorales Departamentales.", correct: false },
      { text: "c)    Brindar asistencia, información y capacitación a las juradas y jurados electorales, de acuerdo con las directrices emitidas por los Tribunales Electorales Departamentales.", correct: true },
    ]
  },
  {
    text: "15. Señale una de las responsabilidades de las notarías y los notarios electorales establecido en el Reglamento para las Elecciones Gene­rales 2025, en caso de que no se presenten tres jurados hasta las 09:00 a.m.",
    answers: [
      { text: "a)    Capacitar a juradas y jurados electorales cuando, por falta de quórum, no se hubiera instalado la mesa de sufragio hasta las 9:00 de la mañana.", correct: false },
      { text: "b)    Designar y capacitar a nuevas juradas y jurados electorales cuando, por falta de quórum, no se hubiera instalado la mesa de sufragio hasta las 9:00 de la mañana.", correct: true },
      { text: "c)    Designar a nuevas juradas y jurados electorales, cuando no se hubiera instalado la mesa de sufragio hasta las 8:00 de la mañana.", correct: false },
    ]
  },
  {
    text: "16. Indique una de las responsabilidades de las notarias y los notarios electorales en la jornada electoral.",
    answers: [
      { text: "a)    Las nuevas autoridades designadas como juradas y jurados deberán ser ciudadanas o ciudadanos inscritos y presentes en la mesa de sufragio.", correct: true },
      { text: "b)    Las nuevas autoridades designadas como guías electorales deberán ser ciudadanas o ciudadanos inscritos y presentes en la mesa de sufragio.", correct: false },
      { text: "c)    Las nuevas autoridades designadas como jueces electorales deberán ser ciudadanas o ciudadanos inscritos y presentes en la mesa de sufragio.", correct: false },
    ]
  },
  {
    text: "17. ¿Cuánto es el monto en moneda nacional para cancelar el estipendio a las juradas y jurados elec­torales?",
    answers: [
      { text: "a)    60 Bolivianos.", correct: true },
      { text: "b)    100 Bolivianos.", correct: false },
      { text: "c)    80 Bolivianos.", correct: false },
    ]
  },
  {
    text: "18. ¿Qué responsabilidades tendrán las notarias y los notarios electorales por sus actos u omisiones ante el Tribunal Electoral Departamental?",
    answers: [
      { text: "a)    Las notarias y notarios electorales serán responsables por sus actos u omisiones ante el Tribunal Supremo Electoral respectivo, sin perjuicio de las responsabilidades penales o civiles que determine la justicia ordinaria.", correct: false },
      { text: "b)    Las notarias y notarios electorales serán responsables por sus actos u omisiones ante el Tribunal Electoral Departamental respectivo, sin perjuicio de las responsabilidades penales o civiles que determine la justicia ordinaria.", correct: true },
      { text: "c)    Las notarias y notarios electorales serán responsables por sus actos u omisiones ante el Órgano Electoral Plurinacional respectivo, sin perjuicio de las responsabilidades penales o civiles que determine la justicia ordinaria.", correct: false },
    ]
  },
  {
    text: "19. ¿En el área rural el certificado de impedimento de sufragio por quién será extendido?",
    answers: [
      { text: "a)           Por la notaria o notario.", correct: true },
      { text: "b)           Por las jueces o los jueces electorales.", correct: false },
      { text: "c)            Por los guías electorales.", correct: false },
    ]
  },
  {
    text: "20. Señale una de las responsabilidades de las notarias y los notarios electorales establecido en el Reglamento para las Elecciones Gene­rales 2025.",
    answers: [
      { text: "a)    Custodiar el material electoral el día de la elección, y devolverlo al Tribunal Electoral Departamental en cumplimiento del protocolo de la cadena de custodia.", correct: false },
      { text: "b)    Entregar el material electoral el día de la elección, y devolverlo al Tribunal Electoral Departamental en cumplimiento del protocolo de la cadena de custodia.", correct: false },
      { text: "c)    Recibir, custodiar y entregar el material electoral el día de la elección, y devolverlo al Tribunal Electoral Departamental en cumplimiento del protocolo de la cadena de custodia.", correct: true },
    ]
  },
  {
    text: "21. Durante la Junta de Organización de la Mesa de Sufragio la notaria o el notario electoral deberá:",
    answers: [
      { text: "a)    1) Ordenar el ambiente, 2) elaborar las actas de conformación de la directiva registrando los nombres y cargos de las juradas, 3) capacitar a los jurados en cuando a sus funciones que desempeñaran.", correct: false },
      { text: "b)    1) Orientar a las juradas y jurados en la conformación de la Junta de la Mesa de Sufragio, 2) Controlar la asistencia de las juradas y jurados electorales, 3) Elaborar las actas de conformación de la Junta de la Mesa de sufragio, registrando los nombres y cargos de las juradas y jurados designados.", correct: true },
      { text: "c)    1) Entregar acta de designación, 2) controlar asistencia de jurados y juradas, 3) designar al presidente secretario y vocales.", correct: false },
    ]
  },
  {
    text: "22. ¿Durante la Junta de Organización de Juradas y Jurados de la Mesa de Sufragio, la notaria o el notario electoral deberá reportar la asistencia de los mismos, a través de la aplicación del sistema?",
    answers: [
      { text: "a)    Verdadero", correct: true },
      { text: "b)    Falso", correct: false },
      { text: "c)    Ninguna de las anteriores", correct: false },
    ]
  },
  {
    text: "23. La directiva encargada de conducir el desarrollo de la jornada de votación es:",
    answers: [
      { text: "a)    Presidenta presidente, secretaria secretario, vocales y notario electoral", correct: false },
      { text: "b)    Notario, presidente y presidenta, secretaria secretario, vocales y custodio policial", correct: false },
      { text: "c)    Presidenta o presidente, secretaria o secretario, vocales", correct: true },
    ]
  },
  {
    text: "24. Las funciones de las Jurados y Jurados electorales el día de la jornada electoral son:",
    answers: [
      { text: "a)    Recepción de la maleta, organización de la mesa de sufragio, control de la votación, escrutinio y cómputo, devolución de material electoral", correct: false },
      { text: "b)    Recepción de la maleta, entrega de cedula de identidad, instalación de la mesa de sufragio, escrutinio y cómputo de votos, llenado acta electoral armada y cierre de los sobres de seguridad", correct: false },
      { text: "c)    Recepción de la maleta, instalación de la mesa de sufragio, conducción del procedimiento de votación, llenado acta electoral armada y cierre de los sobres de seguridad", correct: true },
    ]
  },
  {
    text: "25. La recepción y distribución de la maleta electoral se realizará en:",
    answers: [
      { text: "a)    Los recintos correspondientes a cada notario", correct: false },
      { text: "b)    El Tribunal Departamental Electoral", correct: false },
      { text: "c)    El Centro Departamental de Logística", correct: true },
    ]
  },
  {
    text: "26. La entrega de maletas electorales y bolsas de recinto a las notarias y notarios electorales en el área urbana será:",
    answers: [
      { text: "a)    72 horas antes de la votación", correct: false },
      { text: "b)    48 horas antes de la votación", correct: false },
      { text: "c)    Ninguna de las anteriores", correct: true },
    ]
  },
  {
    text: "27. En área rural o dispersa la entrega de maletas electorales y de las bolsas de recinto se las hará:",
    answers: [
      { text: "a)    48 horas antes de la jornada electoral", correct: true },
      { text: "b)    24 horas antes de la jornada electoral", correct: false },
      { text: "c)    36 horas antes de la votación", correct: false },
    ]
  },
  {
    text: "28. ¿Quién determina el lugar donde funcionaran las Mesas de Sufragio?",
    answers: [
      { text: "a)    Los jurados y juradas de mesa", correct: false },
      { text: "b)    El Notario o notaria electoral", correct: true },
      { text: "c)    El custodio", correct: false },
    ]
  },
  {
    text: "29. Las y los delegados de las Organizaciones Políticas estarán en la misma mesa que los Juradas y Jurados de las Mesas de Sufragio",
    answers: [
      { text: "a)    Verdadero", correct: false },
      { text: "b)    Falso", correct: true },
    ]
  },
  {
    text: "30. No debe existir ningún tipo de propaganda política alrededor del recinto electoral a menos de:",
    answers: [
      { text: "a)    200 metros del recinto de votación", correct: false },
      { text: "b)    100 metros del recinto votación", correct: true },
      { text: "c)    300 metros del recinto de votación", correct: false },
    ]
  },
  {
    text: "31. Los notarios y notarias electorales el día de la votación deben presentarse en el recinto electoral",
    answers: [
      { text: "a)    Una hora antes de la votación", correct: false },
      { text: "b)    Dos horas antes", correct: false },
      { text: "c)    Tres horas antes", correct: true },
    ]
  },
  {
    text: "32. Para el desprecintado del ambiente seguro es necesario la presencia del custodio policial o militar",
    answers: [
      { text: "a)    Verdadero", correct: true },
      { text: "b)    Falso", correct: false },
    ]
  },
  {
    text: "33. Antes de la jornada electoral, la maleta electoral se entrega:",
    answers: [
      { text: "a)     Al primer jurado o jurada electoral asistente", correct: false },
      { text: "b)     Como mínimo a tres juradas o jurados electorales", correct: false },
      { text: "c)      Ninguna de las anteriores", correct: true },
      { text: "d)     Al presidente de mesa", correct: false },
    ]
  },
  {
    text: "34. Si una jurada o jurado electoral no se presenta ¿hasta qué hora se puede designar a un nuevo jurado o jurada electoral",
    answers: [
      { text: "a)     Depende de la situación si hay o no hay voluntarios.", correct: false },
      { text: "b)     Hasta las 9 de la mañana.", correct: true },
      { text: "c)      Hasta las 8 de la mañana.", correct: false },
    ]
  },
  {
    text: "35. ¿A qué hora deben estar los notarios en el recinto electoral?",
    answers: [
      { text: "a)    05:00 am.", correct: true },
      { text: "b)    06:00 am.", correct: false },
      { text: "c)    08:00 am.", correct: false },
    ]
  },
  {
    text: "36. ¿Qué actividad realiza el notario cuando llega al recinto electoral?",
    answers: [
      { text: "a)    Se toma un café", correct: false },
      { text: "b)    Prepara recinto electoral y entrega maletas a jurados electoral", correct: true },
      { text: "c)    Recibe a los jurados electorales", correct: false },
    ]
  },
  {
    text: "37. ¿Cuántos jurados deben estar mínimamente en la mesa de sufragio y a qué hora deben presentarse en el recinto electoral para recoger maleta?",
    answers: [
      { text: "a)    6 jurados a horas 6 de la mañana", correct: false },
      { text: "b)    3 jurados a horas 6 de la mañana", correct: true },
      { text: "c)    4 jurados a horas 5 de la mañana", correct: false },
    ]
  },
  {
    text: "38. ¿Qué documentos debe presentar el jurado electoral para que le entreguen la maleta?",
    answers: [
      { text: "a)    Solo carnet de identidad", correct: false },
      { text: "b)    Solo memorándum", correct: false },
      { text: "c)    Carnet de identidad y memorándum de designación", correct: true },
    ]
  },
  {
    text: "39. ¿Después de recojo de maletas electorales que actividad realizan los jurados Electorales?",
    answers: [
      { text: "a)    Sentarse y conversar", correct: false },
      { text: "b)    Llenar el acta", correct: false },
      { text: "c)    Preparar mesa de sufragio y armado de ánfora", correct: true },
    ]
  },
  {
    text: "40. ¿A qué hora inicia la votación?",
    answers: [
      { text: "a)    Horas 07:00 am.", correct: false },
      { text: "b)    Horas 08:00 am.", correct: true },
      { text: "c)    Horas 09:00 am.", correct: false },
    ]
  },
  {
    text: "41. ¿Cuánto tiempo antes recogen la maleta electoral para el en el área rural  y urbana del CDL?",
    answers: [
      { text: "a)     Área Rural 24 horas antes y urbana 48 horas antes", correct: false },
      { text: "b)     Área Rural 48 horas antes y urbana 25 horas antes", correct: false },
      { text: "c)      Área Rural 48 horas antes y urbana 24 horas antes", correct: true },
    ]
  },
  {
    text: "42. ¿Quiénes son los notarios electorales?",
    answers: [
      { text: "a)    Son personas que ayudan al público", correct: false },
      { text: "b)    Son autoridades designados por el TED.", correct: true },
      { text: "c)    Son guías electorales", correct: false },
    ]
  },
  {
    text: "43. ¿Qué función cumple el notario electoral?",
    answers: [
      { text: "a)    Cumple funciones de apoyo logístico y operativo, para dar fe pública de los actos  electorales", correct: true },
      { text: "b)    Son autoridades designadas", correct: false },
      { text: "c)    Atiende a los ciudadanos", correct: false },
    ]
  },
  {
    text: "44. ¿Encuentra tres falta de notarios notarias electorales?",
    answers: [
      { text: "a)    No asistir a la organización de jurados y juradas electorales", correct: true },
      { text: "b)    No apoyar en la capacitación de juradas y jurados electorales", correct: true },
      { text: "c)    Ausentarse del recinto electoral", correct: true },
      { text: "d)    Entrega oportunamente los sobres de seguridad", correct: false },
    ]
  },
  {
    text: "45. ¿A qué hora deben presentarse las notarías/os electorales en el recinto el día de la votación?",
    answers: [
      { text: "a)    07:00 a.m.", correct: false },
      { text: "b)    05:00 a.m.", correct: true },
      { text: "c)    06:00 a.m.", correct: false },
    ]
  },
  {
    text: "46. ¿Qué debe hacer una notaría o notario electoral si a las 09:00 a.m. no hay jurados en una mesa de sufragio?",
    answers: [
      { text: "a)    Esperar a que lleguen.", correct: false },
      { text: "b)    Suspender la mesa de sufragio.", correct: false },
      { text: "c)    Designar y capacitar nuevos jurados electorales presentes en el recinto.", correct: true },
    ]
  },
  {
    text: "47. ¿Qué acción no está permitida antes de entregar la maleta electoral a una mesa de sufragio?",
    answers: [
      { text: "a)    Verificar la presencia de jurados designados.", correct: false },
      { text: "b)    Entregar la maleta con un solo jurado presente.", correct: true },
      { text: "c)    Firmar el formulario de entrega.", correct: false },
    ]
  },
  {
    text: "48. ¿Cuál es una función que debe cumplir la notaria o notario electoral  durante el proceso de votación?",
    answers: [
      { text: "a)    Contar los votos emitidos.", correct: false },
      { text: "b)    Apoyar y orientar a las juradas y jurados electorales.", correct: true },
      { text: "c)    Emitir sufragio preferente.", correct: false },
    ]
  },
  {
    text: "49. ¿Qué personas tienen voto preferente durante la jornada electoral?",
    answers: [
      { text: "a)    Jurados electorales.", correct: false },
      { text: "b)    Delegados de partidos políticos.", correct: false },
      { text: "c)    Personas mayores de 60 años, con discapacidad, embarazadas y con niños en brazos.", correct: true },
    ]
  },
  {
    text: "50. ¿Qué debe hacer la notaria o notario electoral con las personas que reclaman inhabilitación en el Padrón Electoral?",
    answers: [
      { text: "a)    Enviarlas directamente a su casa.", correct: false },
      { text: "b)    Atenderlas, orientarles y, si corresponde, extender certificado de exención.", correct: true },
      { text: "c)    Permitirles votar inmediatamente.", correct: false },
    ]
  },
  {
    text: "51. ¿Qué acción debe tomar la notaria o notario electoral sobre la propaganda política durante el día de votación?",
    answers: [
      { text: "a)    Permitirla solo fuera del recinto.", correct: false },
      { text: "b)    Verificar que no exista propaganda dentro ni a 100 metros del recinto.", correct: true },
      { text: "c)    Ignorarla si no interfiere con el voto.", correct: false },
    ]
  },
  {
    text: "52. ¿Qué documento debe entregar la notaria o notario electoral  tras realizar el pago a juradas y jurados?",
    answers: [
      { text: "a)    Hoja de trabajo.", correct: false },
      { text: "b)    Planilla de pago firmada.", correct: true },
      { text: "c)    Acta Electoral.", correct: false },
    ]
  },
  {
    text: "53. ¿Qué sistema debe usar la notaria o notario electoral  para reportar información durante la jornada?",
    answers: [
      { text: "a)    Mensajes de texto al TED.", correct: false },
      { text: "b)    Sistema informático oficial del Órgano Electoral Plurinacional.", correct: true },
      { text: "c)    Llamadas a la fuerza pública.", correct: false },
    ]
  },
  {
    text: "54. ¿Qué función realiza la notaria/o con el personal de seguridad el día de la votación?",
    answers: [
      { text: "a)    Reemplazarlo si no se presenta.", correct: false },
      { text: "b)    Coordinar aspectos de seguridad y custodia del material electoral.", correct: true },
      { text: "c)    Delegarle la apertura del recinto.", correct: false },
    ]
  },
  {
    text: "55. ¿A qué hora deben estar las y los jurados electorales en sus recintos electorales el día de la jornada electoral?",
    answers: [
      { text: "a)    5:00 am.", correct: false },
      { text: "b)    7:00 am.", correct: false },
      { text: "c)    6:00 am.", correct: true },
    ]
  },
  {
    text: "56. ¿Quiénes son los primeros ciudadanos en emitir su voto?",
    answers: [
      { text: "a)    Las y los delegados de partidos y organizaciones políticas", correct: false },
      { text: "b)    Las juradas y los jurados de la mesa de sufragio", correct: true },
      { text: "c)    La personas de la tercera edad", correct: false },
    ]
  },
  {
    text: "57. ¿Durante la jornada electoral quienes tienen prioridad para emitir su voto?",
    answers: [
      { text: "a)    Las candidatas o candidatos", correct: false },
      { text: "b)    Las personas adultas mayores de 60 años, personas enfermas o con discapacidad", correct: false },
      { text: "c)    Las personas adultas mayores de 60 años, personas enfermas o con discapacidad, mujeres embarazadas, candidatas o candidatos, y personas con niñas o niños en brazos", correct: true },
    ]
  },
  {
    text: "58. ¿Cuál es el documento válido para que la ciudadana o ciudadano pueda emitir su voto?",
    answers: [
      { text: "a)    Libreta de servicio militar, cedula de identidad vigente, pasaporte, licencia de conducir", correct: false },
      { text: "b)    Libreta de servicio militar y cedula de identidad vigente", correct: false },
      { text: "c)    Ninguno", correct: true },
    ]
  },
  {
    text: "59. ¿El pago del estipendio a las juradas y jurados electorales presentes se realiza?",
    answers: [
      { text: "a)     Antes de la votación", correct: false },
      { text: "b)     Al finalizar la jornada de votación", correct: false },
      { text: "c)      A medio día de la jornada de votación", correct: true },
    ]
  },
  {
    text: "60. ¿Qué debe hacer el notario electoral en caso de que en una de sus mesas electorales no tenga mínimamente a tres juradas o jurados electorales?",
    answers: [
      { text: "a)     No habilitar esa mesa", correct: false },
      { text: "b)     Reportar a su coordinador", correct: false },
      { text: "c)      Designar nuevos jurados electorales hasta las 9:00 am", correct: true },
    ]
  },
  {
    text: "61. ¿Faltas cometidas por las o los jurados electorales?",
    answers: [
      { text: "a)    La inasistencia a las Juntas de Jurados, no cumplir los horarios establecidos para la apertura    y cierre de la mesa, abandono de la mesa de sufragio, presentarse en estado de ebriedad.", correct: false },
      { text: "b)    Ausencia temporal de la mesa de sufragio sin autorización de la Presidenta, negarse a firmar el acta electoral o también negarse a consignar los datos.", correct: false },
      { text: "c)    A y B", correct: true },
    ]
  },
  {
    text: "62. ¿Para el cierre de la votación que se debe considerar?",
    answers: [
      { text: "a)     Las 8 hrs. continuas, a partir de la apertura de mesa y se extenderá cuando existan están ciudadanas y ciudadanos esperando en la fila que aún no hayan votado.", correct: false },
      { text: "b)     Cuando la totalidad de las y los ciudadanos que están inscritos en la lista de la mesa de sufragio haya emitido su voto podrán cerrar la mesa antes de las 8 horas.", correct: false },
      { text: "c)      Todas las anteriores", correct: true },
    ]
  },
  {
    text: "63. ¿La apertura del acta en qué momento se lo debe realizar?",
    answers: [
      { text: "a)     Previo al inicio de la votación", correct: true },
      { text: "b)     Al finalizar la votación", correct: false },
      { text: "c)      después del conteo de votos y llenado de las hojas de trabajo", correct: false },
    ]
  },
  {
    text: "64. ¿El certificado de sufragio que se extiende a la o el ciudadano, quien debe de firmarlo?",
    answers: [
      { text: "a)     La o el delegados de partido u organización política", correct: false },
      { text: "b)     la secretaria o secretario de mesa electoral", correct: false },
      { text: "c)     La presidenta o presiente de mesa", correct: true },
    ]
  },
  {
    text: "65. ¿Con qué documentos deben presentarse los jurados electorales ante su notario electoral el 17 de agosto?",
    answers: [
      { text: "a)    Cedula de Identidad", correct: false },
      { text: "b)    Memorándum de designación", correct: false },
      { text: "c)    A y B", correct: true },
      { text: "d)    Ninguna de las anteriores", correct: false },
    ]
  },
  {
    text: "66. Las notarías y los notarios electorales deberán cumplir con las siguientes funciones:",
    answers: [
      { text: "a)    Apoyar y orientar a las juradas y jurados electorales", correct: false },
      { text: "b)    Atender a la ciudadanía", correct: false },
      { text: "c)    Entregar estipendios", correct: false },
      { text: "d)    Coordinar con la fuerza pública", correct: false },
      { text: "e)    Todas", correct: true },
    ]
  },
  {
    text: "67. ¿El Inicio de votación es?",
    answers: [
      { text: "a)    7 am", correct: false },
      { text: "b)    5 am", correct: false },
      { text: "c)    8 am", correct: true },
      { text: "d)    Ninguna", correct: false },
    ]
  },
  {
    text: "68. ¿Las primeras personas en emitir su voto el día de las elecciones son?",
    answers: [
      { text: "a)    Los primeros de la fila", correct: false },
      { text: "b)    Las personas de tercera edad y las mujeres con embarazo notorio.", correct: false },
      { text: "c)    Las juradas y jurados electorales.", correct: true },
    ]
  },
  {
    text: "69. ¿El voto preferente durante la jornada electoral tienen prioridad para emitir su voto las personas?",
    answers: [
      { text: "a)    Adultas mayores de 60 años", correct: false },
      { text: "b)    Personas enfermas o con discapacidad", correct: false },
      { text: "c)    Mujeres embarazadas", correct: false },
      { text: "d)    Candidatas o candidatos", correct: false },
      { text: "e)     Personas con niñas o niños en brazos", correct: true },
    ]
  },
  {
    text: "70. La electora o elector presentará su cédula de identidad vigente al:",
    answers: [
      { text: "a)    Presidente o presidenta", correct: true },
      { text: "b)    Secretaria o secretario", correct: false },
      { text: "c)    Vocal", correct: false },
      { text: "d)    Ninguna", correct: false },
    ]
  },
  {
    text: "71. ¿Quién verificará si la electora o elector se encuentra en las listas de personas habilitadas?",
    answers: [
      { text: "a)    Presidente", correct: false },
      { text: "b)    Secretario", correct: true },
      { text: "c)    Vocal", correct: false },
    ]
  },
  {
    text: "72. Una vez concluida las 8 horas de la jornada electoral, al momento de cerrar la Mesa de Sufragio quién anuncia con voz alta ¡CONCLUYE LA VOTACION!!!",
    answers: [
      { text: "a)    Presidente o presidenta", correct: true },
      { text: "b)    Secretario o secretaria", correct: false },
      { text: "c)    Vocales", correct: false },
    ]
  },
  {
    text: "73. ¿Qué forma de voto es cuando la presidenta o presidente de la mesa de sufragio  escoge a una persona de la fila para que ingrese como testigo y marca la papeleta siguiendo la voluntad de la electora o elector, en presencia del testigo.",
    answers: [
      { text: "a)    Con Acompañante", correct: false },
      { text: "b)    Con Testigo", correct: true },
      { text: "c)    A y B", correct: false },
      { text: "d)    Ninguna", correct: false },
    ]
  },
  {
    text: "74. ¿Cómo se realiza la elección de Juradas y Jurados Electorales de la Elección de Autoridades y Representantes del Estado Plurinacional de Bolivia?",
    answers: [
      { text: "a)    Son designados por el Tribunal Electoral Departamental", correct: false },
      { text: "b)    Son designados por un voto ciudadano", correct: false },
      { text: "c)    Son designados por sorteo mediante una aplicación informática", correct: true },
    ]
  },
  {
    text: "75. ¿De quién es la responsabilidad de notificar a los jurados electorales para las Elecciones Generales de Autoridades y Representantes del Estado Plurinacional de Bolivia?",
    answers: [
      { text: "a)    El ciudadano debe apersonase al Tribunal Electoral Departamental", correct: false },
      { text: "b)    Es responsabilidad de las Notarias y Notarios Electorales de notificar  a las Juradas y Jurados Electorales", correct: true },
      { text: "c)    Es Responsabilidad de los Medios de Comunicación la Notificación de las y los Jurados Electorales", correct: false },
    ]
  },
  {
    text: "76. ¿Qué otros medios de difusión y notificación puedes identificar para notificar a las Juradas y Jurados Electorales?",
    answers: [
      { text: "a)    Redes sociales, colocación de carteles con la nómina en espacios públicos de acceso comunitario, tales como sedes de juntas vecinales o recintos electorales.", correct: true },
      { text: "b)    Publicar la Foto de las Juradas y Jurados  Electorales designados en Postes, Paredes de casas y Parques de su OTB", correct: false },
      { text: "c)    Mandar una Carta por Medios de Representantes del Órgano Electoral Plurinacional", correct: false },
    ]
  },
  {
    text: "77. ¿Qué actividad realiza el notario una vez que ha concluido la votación en la mesa de sufragio?",
    answers: [
      { text: "a)    La notaria o notario electoral supervisa y apoya en el escrutinio y conteo de votos.", correct: true },
      { text: "b)    La notaria o notario electoral apoya en el conteo de votos", correct: false },
      { text: "c)    La notaria o notario electoral apoya en el cierre de la mesa de sufragio", correct: false },
    ]
  },
  {
    text: "78. ¿Qué es el escrutinio de papeletas?",
    answers: [
      { text: "a)    Es el conteo de las papeletas de sufragio una por una, sin desdoblarlas.", correct: true },
      { text: "b)    Es la verificación de los votos de los ciudadanos.", correct: false },
      { text: "c)    Es el total de papeletas entregadas a la mesa de sufragio.", correct: false },
    ]
  },
  {
    text: "79. ¿Cuál es el procedimiento del escrutinio de papeletas?",
    answers: [
      { text: "a)    La Presidenta o Presidente abre el ánfora y cuenta las papeletas en voz alta, una por una sin desdoblarlas, la Secretaria o Secretario verifica en lista de habilitadas y habilitados el número de personas que votaron, el número de papeletas de sufragio en el ánfora debe ser igual al número de ciudadanos y ciudadanos que votaron.", correct: true },
      { text: "b)    Se retira las papeletas del ánfora y se cuenta las papeletas.", correct: false },
      { text: "c)    Se abre el ánfora y se saca todas las papeletas y se empieza a contar todas las papeletas.", correct: false },
    ]
  },
  {
    text: "80. ¿Quiénes pueden participar en el escrutinio de papeletas?",
    answers: [
      { text: "a)    Todas las ciudadanas y ciudadanos, sea o no elector de la mesa de sufragio.", correct: true },
      { text: "b)    Solo las Juradas y los Jurados Electorales de la Mesa de Sufragio.", correct: false },
      { text: "c)    Los notarios y las juradas y jurados electorales de la Mesa de Sufragio.", correct: false },
    ]
  },
  {
    text: "81. ¿Qué es el conteo de papeletas?",
    answers: [
      { text: "a)    Es la suma de resultados de los votos obtenidos en las papeletas de sufragio.", correct: true },
      { text: "b)    Es el conteo de votos que han obtenido las candidatas y candidatos que están en la contienda electoral.", correct: false },
      { text: "c)    Es el conteo de papeletas del ánfora.", correct: false },
    ]
  },
  {
    text: "82. Identifica cuál es el primer paso del procedimiento del conteo de votos",
    answers: [
      { text: "a)    La presidenta o presidente de la mesa de sufragio desdoblará cada papeleta, una por una, y las volverá a doblar horizontalmente, de manera que quede visible la franja superior.", correct: true },
      { text: "b)    La presidenta o el presidente debe mostrar la papeleta electoral.", correct: false },
      { text: "c)    La presidenta o presidente debe cantar los votos de las papeletas.", correct: false },
    ]
  },
  {
    text: "83. ¿Quiénes deben firmar y estampar su huella digital el acta electoral en las elecciones generales 2025?",
    answers: [
      { text: "a) Las y los votantes", correct: false },
      { text: "b) Las y los jurados electorales y los delegados de las Organizaciones Políticas", correct: true },
      { text: "c) Las autoridades del recinto escolar", correct: false },
      { text: "d) Los candidatos de cada partido", correct: false },
    ]
  },
  {
    text: "84. ¿Por qué se considera el acta electoral como el documento más importante?",
    answers: [
      { text: "a) Porque la elabora el Tribunal Supremo Electoral", correct: false },
      { text: "b) Porque contiene propaganda política", correct: false },
      { text: "c) Porque en ella se registran oficialmente los resultados obtenidos en la mesa de sufragio", correct: true },
      { text: "d) Porque tiene fotos de la jornada electoral", correct: false },
    ]
  },
  {
    text: "85. ¿Qué sucede si se utilizan actas electorales no aprobadas por la autoridad electoral?",
    answers: [
      { text: "a) Se repiten las elecciones solo en esa mesa", correct: false },
      { text: "b) Se anula la mesa", correct: true },
      { text: "c) Se cuentan igual los votos", correct: false },
      { text: "d) Se envía el acta a revisión", correct: false },
    ]
  },
  {
    text: "86. ¿Dónde deben funcionar las mesas de sufragio?",
    answers: [
      { text: "a) En cualquier lugar del municipio", correct: false },
      { text: "b) Solamente en el recinto asignado", correct: true },
      { text: "c) En cualquier recinto del país", correct: false },
      { text: "d) En la casa del jurado presidente", correct: false },
    ]
  },
  {
    text: "87. ¿Cuál podría ser un motivo justificado para mover la mesa dentro del recinto?",
    answers: [
      { text: "a) Capricho de un jurado", correct: false },
      { text: "b) Que la mesa esté muy lejos de la puerta", correct: false },
      { text: "c) Lluvia o condiciones climáticas adversas", correct: true },
      { text: "d) Que falte una urna", correct: false },
    ]
  },
  {
    text: "88. ¿Qué puede causar la nulidad del acta electoral?",
    answers: [
      { text: "a) Errores de ortografía en los nombres", correct: false },
      { text: "b) Existencia de elementos que contradicen los datos consignados en el acta, aunque no estén en la casilla de observaciones", correct: true },
      { text: "c) Falta de boletas sobrantes", correct: false },
      { text: "d) Que la mesa termine tarde", correct: false },
    ]
  },
  {
    text: "89. ¿Qué sucede si se abre el ánfora (urna) durante el proceso de votación?",
    answers: [
      { text: "a) Se continúa normalmente", correct: false },
      { text: "b) Solo se registra en observaciones", correct: false },
      { text: "c) Puede implicar la nulidad del acta electoral", correct: true },
      { text: "d) Se reparten más papeletas", correct: false },
    ]
  },
  {
    text: "90. ¿Por qué la inconsistencia de datos puede anular el acta electoral?",
    answers: [
      { text: "a) Porque el acta debe ser entregada el mismo día", correct: false },
      { text: "b) Porque compromete la transparencia y confiabilidad del proceso", correct: true },
      { text: "c) Porque demora el cómputo", correct: false },
      { text: "d) Porque se usa demasiado papel", correct: false },
    ]
  },
  {
    text: "91. ¿Qué debe reflejar el acta electoral para que sea válida?",
    answers: [
      { text: "a) Solo los resultados finales", correct: false },
      { text: "b) Únicamente las observaciones de los delegados", correct: false },
      { text: "c) Todos los datos reales y coherentes de la jornada electoral", correct: true },
      { text: "d) La opinión de los jurados sobre el procedimiento", correct: false },
    ]
  },
  {
    text: "92. ¿Qué sucede si hay diferencias entre el del acta electoral original y sus copias?",
    answers: [
      { text: "a) Solo se toma en cuenta el original", correct: false },
      { text: "b) Se repite la elección", correct: false },
      { text: "c) Puede ser causal de nulidad de la mesa", correct: true },
      { text: "d) Se corrige al día siguiente", correct: false },
    ]
  },
  {
    text: "93. ¿Qué sucede si se viola la integridad del sobre de seguridad “A”?",
    answers: [
      { text: "a) No pasa nada", correct: false },
      { text: "b) Se suspende la elección en toda la circunscripción", correct: false },
      { text: "c) Puede ser causa de nulidad del acta o mesa", correct: true },
      { text: "d) Solo se registra como observación", correct: false },
    ]
  },
  {
    text: "94. ¿Qué ocurre si se extravía el acta original y no existen dos copias auténticas que la reemplacen?",
    answers: [
      { text: "a) Se anula la mesa", correct: true },
      { text: "b) Se repite toda la elección", correct: false },
      { text: "c) Se reemplaza con un acta en blanco", correct: false },
      { text: "d) Se suma la votación igual", correct: false },
    ]
  },
  {
    text: "95.  ¿Por qué es importante el sobre de seguridad “A”?",
    answers: [
      { text: "a) Porque guarda los bolígrafos usados", correct: false },
      { text: "b) Porque contiene el acta original como principal documento que refleja los resultados de la mesa de sufragio", correct: true },
      { text: "c) Porque tiene propaganda electoral", correct: false },
      { text: "d) Porque evita que los jurados pierdan su material", correct: false },
    ]
  },
  {
    text: "96. ¿A qué hora  debe cerrar las mesas de sufragio el notario electoral?",
    answers: [
      { text: "a)    A las 16:00", correct: false },
      { text: "b)    Luego de ocho horas de trabajo desde la apertura de la mesa de sufragio.", correct: false },
      { text: "c)    Ninguna de las anteriores", correct: true },
    ]
  },
  {
    text: "97. ¿Durante el escrutinio, en qué caso son anuladas las papeletas de sufragio?",
    answers: [
      { text: "a)     Cuando está marcada más de una vez", correct: false },
      { text: "b)     Cuando no coincida el número de papeletas con la cantidad de votantes registrados", correct: true },
      { text: "c)     Cuando el ciudadano marcó más de dos veces en una papeleta de sufragio.", correct: false },
    ]
  },
  {
    text: "98. ¿Durante el conteo de votos, cuando el presidente de la mesa de sufragio, canta los votos en voz alta, estos son registrados en:",
    answers: [
      { text: "a)     En la hoja de trabajo", correct: true },
      { text: "b)     En el acta electoral", correct: false },
      { text: "c)      Ninguna de las anteriores", correct: false },
    ]
  },
  {
    text: "99. ¿Dónde se registra el conteo de votos válidos para diputados plurinominales?",
    answers: [
      { text: "a)     En la hoja de trabajo para diputados plurinominales", correct: false },
      { text: "b)     No se registran", correct: true },
      { text: "c)      En la hoja de trabajo para presidente y vicepresidente", correct: false },
    ]
  },
  {
    text: "100. ¿La cantidad de papeletas en ánfora debe ser igual a:",
    answers: [
      { text: "a)     La cantidad de personas habilitadas en la mesa de sufragio", correct: false },
      { text: "b)     La cantidad de votos válidos", correct: false },
      { text: "c)      El total de votos emitidos por los electores", correct: true },
    ]
  },
  {
    text: "101. La primera copia del acta electoral se entrega a:",
    answers: [
      { text: "a)     Al operador de transmisión", correct: true },
      { text: "b)     Al presidente de la mesa de sufragio", correct: false },
      { text: "c)      Al notario electoral", correct: false },
    ]
  },
  {
    text: "102. La presidenta o el presidente de la mesa de sufragio, muestra a todos los asistentes el acta electoral por al menos:",
    answers: [
      { text: "a)     30 segundos", correct: true },
      { text: "b)     1 minuto", correct: false },
      { text: "c)      El secretario o secretaria no muestra el acta electoral", correct: false },
    ]
  },
  {
    text: "103. Se entrega una copia del acta electoral a los delegados de organizaciones políticas presentes en el escrutinio y conteo de votos?",
    answers: [
      { text: "a)     Si, porque se acreditaron en la mesa de sufragio", correct: true },
      { text: "b)     No, porque no se acreditó a las 08:00 en la mesa de sufragio", correct: false },
      { text: "c)     No corresponde entregar copias del acta electoral a los delegados de organizaciones políticas", correct: false },
    ]
  },
  {
    text: "104. ¿En el sobre A  no se deben introducir los siguientes documentos:",
    answers: [
      { text: "a)     Hojas de trabajo", correct: false },
      { text: "b)     Copias sobrantes del acta electoral", correct: false },
      { text: "c)     Papeletas de sufragio utilizadas", correct: true },
    ]
  },
  {
    text: "105. Concluido el proceso de votación, la notaria o notario electoral deberá trasladar la maleta electoral a:",
    answers: [
      { text: "a)        El Tribunal Departamental de Cochabamba", correct: false },
      { text: "b)        Al Centro de cómputo", correct: false },
      { text: "c)         Al Centro Departamental de Logística", correct: true },
    ]
  },
  {
    text: "106. Son causales de nulidad del acta electoral:",
    answers: [
      { text: "a)        Borrones o tachaduras en el acta electoral que no hayan sido señaladas en las observaciones.", correct: false },
      { text: "b)        El uso de papeletas de sufragio de distinta circunscripción uninominal.", correct: false },
      { text: "c)         A y B son correctas", correct: true },
    ]
  },
  {
    text: "107. Es obligación de las y los notarios electorales:",
    answers: [
      { text: "a)     Apoyar en la capacitación de las y los jurados electorales", correct: true },
      { text: "b)     Derivar al juez electoral todos los reclamos de los ciudadanos", correct: false },
      { text: "c)     Verificar que no exista campaña electoral afuera del recinto durante toda la jornada de votación.", correct: false },
    ]
  },
  {
    text: "108. Constituyen faltas electorales cometidas por las y los jurados electorales:",
    answers: [
      { text: "a)     Negarse a firmar el acta electoral", correct: false },
      { text: "b)     No cumplir el horario establecido en la apertura y cierre de la mesa de sufragio", correct: false },
      { text: "c)     A y B son correctas", correct: true },
    ]
  },
  {
    text: "109. ¿Quiénes pueden estar presentes en el vehículo oficial de traslado de sobres de seguridad y maletas electorales?",
    answers: [
      { text: "a)     Notarias y notarios electorales", correct: true },
      { text: "b)     Delegados de Organizaciones Políticas", correct: false },
      { text: "c)     A y B son correctas", correct: false },
    ]
  },
  {
    text: "110.             ¿Quién es la máxima autoridad electoral el día de las elecciones en cada mesa de sufragio?",
    answers: [
      { text: "a)    El Delegado de Partido", correct: false },
      { text: "b)    Las Juradas y los Jurados Electorales", correct: true },
      { text: "c)    El ciudadano o elector", correct: false },
    ]
  },
  {
    text: "111. ¿Quiénes designan a los jueces electorales?",
    answers: [
      { text: "a) La Asamblea Legislativa Plurinacional", correct: false },
      { text: "b) Los Tribunales Electorales Departamentales", correct: true },
      { text: "c) El Consejo de la Magistratura", correct: false },
    ]
  },
  {
    text: "112. ¿Cuál es el monto que reciben los Jurados de mesa como estipendio el día de la votación?",
    answers: [
      { text: "a)    Bs100", correct: false },
      { text: "b)    Bs80", correct: false },
      { text: "c)    Bs60", correct: true },
    ]
  },
  {
    text: "113. ¿Qué documento es indispensable para que un ciudadano pueda emitir su voto?",
    answers: [
      { text: "a)    Pasaporte vigente.", correct: false },
      { text: "b)    Cédula de identidad vigente o vencida hasta por un año", correct: true },
      { text: "c)    Carnet de organización política.", correct: false },
    ]
  },
  {
    text: "114. ¿Qué sucede si ninguna candidatura a la Presidencia y Vicepresidencia obtiene los porcentajes necesarios en la primera vuelta electoral?",
    answers: [
      { text: "a)    Se anula la elección y se convoca a nuevas elecciones generales.", correct: false },
      { text: "b)    Se elige al candidato con más votos, aunque no cumpla los requisitos.", correct: false },
      { text: "c)    Se realiza una segunda vuelta electoral entre los dos candidatos más votados.", correct: true },
    ]
  },
  {
    text: "115. ¿En el caso de que una organización política decida no participar en las elecciones y ya se haya impreso el material electoral, los votos que reciba esa organización serán:",
    answers: [
      { text: "a)    Contabilizados como votos blancos.", correct: false },
      { text: "b)    Computados como nulos.", correct: true },
      { text: "c)    Transferidos a otra organización política.", correct: false },
    ]
  },
  {
    text: "116. ¿Quién debe declarar formalmente el inicio del acto electoral en una mesa de sufragio?",
    answers: [
      { text: "a)    El delegado del partido político", correct: false },
      { text: "b)   La presidente o el presidente de la mesa de sufragio", correct: true },
      { text: "c)    La ciudadana o ciudadano con mayor edad en la mesa.", correct: false },
    ]
  },
]);
                
                // Variables de estado
                const currentScreen = ref('code');
                const enteredCode = ref('');
                const isCodeBlocked = ref(false);
                const countdown = ref(5);
                const currentUser = ref(null);
                const selectedQuestions = ref([]);
                const currentQuestionIndex = ref(0);
                const selectedAnswers = ref([]);
                const showFeedback = ref(false);
                const answerIsFullyCorrect = ref(false);
                const answerIsPartiallyCorrect = ref(false);
                const userAnswers = ref([]);
                const examStartedAt = ref(null);
                const elapsedTime = ref(0);
                const timerInterval = ref(null);
                const examEndTime = ref(null);
                const timeLeft = ref(0);
                const timeUpdateInterval = ref(null);
                const timeUntilStart = ref(0);
                const timeUntilEnd = ref(0);
                const hasCompletedExam = ref(false);
                const lastExamScore = ref(0);
                const showDownloadNotification = ref(false);
                const showAutoDownloadNotification = ref(false);
                const examResults = ref(null);
                const currentQuestionImage = ref(null);
                const questionImages = ref({});
                const showLocationModal = ref(false);
                const examLocation = ref(null);
                const examStartTime = ref(null);
                const examFinishTime = ref(null);
                const locationError = ref(null);
                const attemptNumber = ref(1);
                const isAdmin = ref(false);
                const showConfig = ref(false);
                const leafletMap = ref(null);
                const leafletMarker = ref(null);
                const isMobileDevice = ref(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));
                const codeInput = ref(null);
                const hiddenInput = ref(null);
                const selectedCircunscripcion = ref('');
                const mongoId = ref(null);
                const finishEF = ref(true);

                // Método para forzar el teclado en móviles
                const showKeyboard = () => {
                    if (hiddenInput.value) {
                        hiddenInput.value.type = 'text';
                        hiddenInput.value.focus();
                        setTimeout(() => {
                            if (codeInput.value) {
                                codeInput.value.focus();
                            }
                        }, 100);
                    }
                };

                // Computed properties
                const currentQuestion = computed(() => selectedQuestions.value[currentQuestionIndex.value]);
                const isLastQuestion = computed(() => currentQuestionIndex.value === selectedQuestions.value.length - 1);
                const allCorrectAnswersSelected = computed(() => {
                    if (!currentQuestion.value) return false;
                    const correctIndices = currentQuestion.value.answers
                        .map((answer, index) => answer.correct ? index : -1)
                        .filter(index => index !== -1);
                    return correctIndices.every(index => selectedAnswers.value.includes(index)) && 
                           selectedAnswers.value.every(index => currentQuestion.value.answers[index].correct);
                });
                const correctAnswersText = computed(() => {
                    if (!currentQuestion.value) return '';
                    return currentQuestion.value.answers
                        .map((answer, index) => answer.correct ? String.fromCharCode(65 + index) : '')
                        .filter(x => x)
                        .join(', ');
                });
                const correctAnswersCount = computed(() => {
                    return userAnswers.value.reduce((acc, answerIndices, qIdx) => {
                        const question = selectedQuestions.value[qIdx];
                        const correctIndices = question.answers
                            .map((answer, idx) => answer.correct ? idx : -1)
                            .filter(idx => idx !== -1);
                        
                        const allCorrectSelected = correctIndices.every(idx => answerIndices.includes(idx));
                        const noIncorrectSelected = answerIndices.every(idx => question.answers[idx].correct);
                        
                        if (allCorrectSelected && noIncorrectSelected) {
                            return acc + 1;
                        }
                        
                        return acc;
                    }, 0);
                });
                const score = computed(() => {
                    const total = selectedQuestions.value.length;
                    if (total === 0) return 0;
                    return Math.round((correctAnswersCount.value / total) * 100);
                });
                const isExamTime = computed(() => {
                    if (developmentMode && isAdmin.value) return true;
                    
                    const now = new Date();
                    const [startHours, startMins] = examConfig.value.startTime.split(':').map(Number);
                    const [endHours, endMins] = examConfig.value.endTime.split(':').map(Number);
                    
                    const startTime = new Date();
                    startTime.setHours(startHours, startMins, 0, 0);
                    
                    const endTime = new Date();
                    endTime.setHours(endHours, endMins, 0, 0);
                    
                    if (timeUntilStart.value <= 0 && timeUntilEnd.value > 0) {
                        return true;
                    }
                    
                    return now >= startTime && now <= endTime;
                });

                // Métodos
                const handleCodeInput = (e) => {
                    enteredCode.value = e.target.value.trim().toUpperCase();
                };
                
                const arraysEqual = (set1, set2) => {
                    if (set1.size !== set2.size) return false;
                    for (const item of set1) {
                        if (!set2.has(item)) return false;
                    }
                    return true;
                };
                
                const isQuestionFullyCorrect = (qIndex) => {
                    const question = selectedQuestions.value[qIndex];
                    const userAnswer = userAnswers.value[qIndex];
                    const correctIndices = question.answers
                        .map((answer, idx) => answer.correct ? idx : -1)
                        .filter(idx => idx !== -1);
                    
                    return arraysEqual(new Set(userAnswer), new Set(correctIndices));
                };
                
                const verifyCode = () => {
                    if (isCodeBlocked.value) return;
                    
                    const trimmedCode = enteredCode.value.trim();
                    const user = signal.value.find(u => u.codigo === trimmedCode);
                    if (user) {
                        currentUser.value = user;
                        
                        const examCompletedCookie = Cookies.get(`completed_${user.codigo}`);
                        const examResultsCookie = Cookies.get(`results_${user.codigo}`);
                        
                        if (examCompletedCookie === 'true' && examResultsCookie) {
                            examResults.value = JSON.parse(examResultsCookie);
                            lastExamScore.value = examResults.value.score;
                            attemptNumber.value = examResults.value.attempt;
                            
                            hasCompletedExam.value = attemptNumber.value >= 2;
                        }
                        
                        const attemptCookie = Cookies.get(`attempt_${user.codigo}`);
                        attemptNumber.value = attemptCookie ? parseInt(attemptCookie) + 1 : 1;
                        
                        if (attemptNumber.value > 2) {
                            hasCompletedExam.value = true;
                            return;
                        }
                        
                        currentScreen.value = 'user-info';
                        enteredCode.value = '';
                    } else {
                        blockCodeInput();
                    }
                };
                
                const blockCodeInput = () => {
                    isCodeBlocked.value = true;
                    countdown.value = 5;
                    
                    const interval = setInterval(() => {
                        countdown.value--;
                        
                        if (countdown.value <= 0) {
                            clearInterval(interval);
                            isCodeBlocked.value = false;
                            enteredCode.value = '';
                        }
                    }, 1000);
                };
                
                const getLocation = () => {
                    return new Promise((resolve, reject) => {
                        if (!navigator.geolocation) {
                            locationError.value = "Geolocalización no soportada en tu navegador";
                            examLocation.value = {
                                    latitude: -17.407689,
                                    longitude: -66.137634,
                                    accuracy: 0
                                }
                            resolve(examLocation.value);
                            return;
                        }

                        navigator.geolocation.getCurrentPosition(
                            (position) => {
                                examLocation.value = {
                                    latitude: position.coords.latitude,
                                    longitude: position.coords.longitude,
                                    accuracy: position.coords.accuracy
                                };
                                locationError.value = null;
                                showLocationModal.value = false;
                                resolve(examLocation.value);
                            },
                            (error) => {
                                let errorMessage;
                                switch(error.code) {
                                    case error.PERMISSION_DENIED:
                                        errorMessage = "Permiso denegado. Debes compartir tu ubicación para continuar.";
                                        break;
                                    case error.POSITION_UNAVAILABLE:
                                        errorMessage = "Información de ubicación no disponible.";
                                        break;
                                    case error.TIMEOUT:
                                        errorMessage = "Tiempo de espera agotado para obtener la ubicación.";
                                        break;
                                    default:
                                        errorMessage = "Error desconocido al obtener la ubicación.";
                                }
                                locationError.value = errorMessage;
                                examLocation.value = {
                                    latitude: -17.407689,
                                    longitude: -66.137634,
                                    accuracy: 0
                                }
                                resolve(examLocation.value);
                            },
                            { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
                        );
                    });
                };
                
                const requestLocation = async () => {
                    try {
                        await getLocation();
                        await startExamAfterLocation();
                    } catch (error) {
                        console.error("Error al obtener ubicación:", error);
                    }
                };
                
                const cancelExam = () => {
                    showLocationModal.value = false;
                    currentScreen.value = 'code';
                    locationError.value = "Examen cancelado: ubicación requerida no proporcionada";
                };
                
                const verifyAndStartExam = async () => {
                    if (!selectedCircunscripcion.value) {
                        alert("Por favor seleccione una circunscripción antes de continuar");
                        return;
                    }
                    
                    if (examConfig.value.requireLocation) {
                        showLocationModal.value = true;
                    } else {
                        await startExamAfterLocation();
                    }
                };
                
                const startExamAfterLocation = async () => {
                    examStartTime.value = new Date();
                    
                    const numQuestions = Math.min(examConfig.value.numQuestions, questionBank.value.length);
                    selectedQuestions.value = shuffleArray([...questionBank.value]).slice(0, numQuestions);
                    
                    selectedQuestions.value.forEach(q => {
                        q.answers = shuffleArray(q.answers);
                    });
                    
                    currentScreen.value = 'exam';
                    examStartedAt.value = new Date();
                    
                    const endTime = new Date(examStartedAt.value);
                    endTime.setMinutes(endTime.getMinutes() + examConfig.value.duration);
                    examEndTime.value = endTime;
                    
                    startTimer();
                    userAnswers.value = [];
                    selectedAnswers.value = [];
                    currentQuestionIndex.value = 0;
                    
                    if (examConfig.value.protectQuestions) {
                        await updateCurrentQuestionImage();
                    }
                    
                    Cookies.set(`attempt_${currentUser.value.codigo}`, attemptNumber.value, { expires: 1 });
                };
                
                const textToImage = async (text, questionId) => {
                    if (questionImages.value[questionId]) {
                        return questionImages.value[questionId];
                    }
                    
                    const maxWidth = isMobileDevice.value ? window.innerWidth - 80 : 600;
                    
                    const tempElement = document.createElement('div');
                    tempElement.style.position = 'absolute';
                    tempElement.style.left = '-9999px';
                    tempElement.style.width = `${maxWidth}px`;
                    tempElement.style.padding = '1rem';
                    tempElement.style.backgroundColor = '#f5f5f5';
                    tempElement.style.borderRadius = '6px';
                    tempElement.style.fontSize = isMobileDevice.value ? '1rem' : '1.15rem';
                    tempElement.style.fontWeight = '500';
                    tempElement.style.color = '#263238';
                    tempElement.style.wordWrap = 'break-word';
                    tempElement.style.whiteSpace = 'normal';
                    tempElement.textContent = text;
                    
                    document.body.appendChild(tempElement);
                    
                    try {
                        const canvas = await html2canvas(tempElement, {
                            width: tempElement.offsetWidth,
                            height: tempElement.offsetHeight,
                            scale: 1,
                            logging: false,
                            useCORS: true,
                            backgroundColor: '#f5f5f5'
                        });
                        
                        const imageData = canvas.toDataURL('image/png');
                        questionImages.value[questionId] = imageData;
                        return imageData;
                    } catch (error) {
                        console.error('Error al convertir texto a imagen:', error);
                        return null;
                    } finally {
                        document.body.removeChild(tempElement);
                    }
                };
                
                const updateCurrentQuestionImage = async () => {
                    if (!examConfig.value.protectQuestions) return;
                    
                    const question = currentQuestion.value;
                    if (!question) return;
                    
                    const questionId = question.text;
                    const imageData = await textToImage(question.text, questionId);
                    currentQuestionImage.value = imageData;
                };
                
                const toggleAnswer = (index) => {
                    if (showFeedback.value) return;
                    
                    if (selectedAnswers.value.includes(index)) {
                        selectedAnswers.value = selectedAnswers.value.filter(i => i !== index);
                    } else {
                        selectedAnswers.value = [...selectedAnswers.value, index];
                    }
                };
                
                const checkAnswer = () => {
                    if (selectedAnswers.value.length === 0) return;
                    
                    showFeedback.value = true;
                    
                    const correctIndices = currentQuestion.value.answers
                        .map((answer, index) => answer.correct ? index : -1)
                        .filter(index => index !== -1);
                    
                    const allSelectedCorrect = selectedAnswers.value.every(index => 
                        currentQuestion.value.answers[index].correct);
                    const allCorrectSelected = correctIndices.every(index => 
                        selectedAnswers.value.includes(index));
                    
                    answerIsFullyCorrect.value = allSelectedCorrect && allCorrectSelected;
                    answerIsPartiallyCorrect.value = allSelectedCorrect && !allCorrectSelected;
                    
                    if (userAnswers.value.length <= currentQuestionIndex.value) {
                        userAnswers.value.push([...selectedAnswers.value]);
                    } else {
                        userAnswers.value[currentQuestionIndex.value] = [...selectedAnswers.value];
                    }
                };
                
                const nextQuestion = async () => {
                    showFeedback.value = false;
                    selectedAnswers.value = [];
                    answerIsFullyCorrect.value = false;
                    answerIsPartiallyCorrect.value = false;
                    
                    if (isLastQuestion.value) {
                        finishExam();
                    } else {
                        currentQuestionIndex.value++;
                        if (examConfig.value.protectQuestions) {
                            await updateCurrentQuestionImage();
                        }
                    }
                };
                
                const startTimer = () => {
                    elapsedTime.value = 0;
                    updateTimeLeft();
                    
                    timerInterval.value = setInterval(() => {
                        elapsedTime.value = Math.floor((new Date() - examStartedAt.value) / 1000);
                        updateTimeLeft();
                        
                        if (timeLeft.value <= 0 && finishEF.value) {
                            finishEF.value =false
                            finishExam();
                        }
                    }, 1000);
                };
                
                const updateTimeLeft = () => {
                    const now = new Date();
                    timeLeft.value = Math.max(0, Math.floor((examEndTime.value - now) / 1000));
                };
                
                const stopTimer = () => {
                    if (timerInterval.value) {
                        clearInterval(timerInterval.value);
                        timerInterval.value = null;
                    }
                };
                
                const initLeafletMap = () => {
                    if (!examLocation.value) return;
                    
                    nextTick(() => {
                        const mapElement = document.getElementById('leaflet-map');
                        if (!mapElement || !mapElement.offsetParent) {
                            setTimeout(initLeafletMap, 100);
                            return;
                        }

                        if (leafletMap.value) {
                            leafletMap.value.remove();
                        }

                        leafletMap.value = L.map('leaflet-map', {
                            preferCanvas: true
                        }).setView(
                            [examLocation.value.latitude, examLocation.value.longitude], 
                            15
                        );

                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                        }).addTo(leafletMap.value);

                        L.marker([examLocation.value.latitude, examLocation.value.longitude])
                            .addTo(leafletMap.value)
                            .bindPopup('Ubicación del examen');

                        setTimeout(() => {
                            leafletMap.value.invalidateSize();
                        }, 50);
                    });
                };
                
                const generateQRCode = async (text) => {
                    return new Promise((resolve) => {
                        QRCode.toDataURL(text, {
                            width: 150,
                            margin: 1,
                            color: {
                                dark: '#000',
                                light: '#ffffff'
                            }
                        }, (err, url) => {
                            if (err) {
                                console.error("Error generando QR:", err);
                                resolve(null);
                            } else {
                                resolve(url);
                            }
                        });
                    });
                };
                
                const generatePDF = async () => {
                    if (!window.jspdf || !window.jspdf.jsPDF) {
                        alert('Error: La funcionalidad de PDF no está disponible. Por favor recarga la página.');
                        return;
                    }
                    
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF({
                        orientation: 'portrait',
                        unit: 'mm',
                        format: 'a4'
                    });
                    
                    const pageWidth = doc.internal.pageSize.getWidth();
                    const margin = 15;
                    const contentWidth = pageWidth - margin * 2;
                    
                    // Generar QR primero y posicionarlo claramente
                    const qrUrl = `https://express-hello-world-dmbr.onrender.com/api/certificados/${mongoId.value || 'exam-result'}`;
                    const qrCode = await generateQRCode(qrUrl);
                    
                    // Posición y tamaño del QR
                    const qrSize = 25;
                    const qrX = pageWidth - margin - qrSize;
                    const qrY = margin;
                    
                    // Añadir el QR con fondo blanco para asegurar visibilidad
                    if (qrCode) {
                        // Fondo blanco para el QR
                        doc.setFillColor(255, 255, 255);
                        doc.rect(qrX - 2, qrY - 2, qrSize + 4, qrSize + 4, 'F');
                        
                        // Añadir el QR
                        doc.addImage(qrCode, 'PNG', qrX, qrY, qrSize, qrSize);
                        
                        // Texto pequeño debajo del QR
                        doc.setFontSize(8);
                        doc.setTextColor(100, 100, 100);
                        doc.text('Escanee para verificar', qrX + qrSize/2, qrY + qrSize + 5, { align: 'center' });
                    }
                    
                    // Encabezado del documento (ajustado para no solapar con QR)
                    doc.setFontSize(20);
                    doc.setTextColor(94, 53, 177);
                    doc.text('Certificado de Examen', margin, 20);
                    
                    // Línea decorativa (más corta para no llegar al QR)
                    doc.setDrawColor(94, 53, 177);
                    doc.setLineWidth(0.5);
                    doc.line(margin, 25, pageWidth - margin - qrSize - 10, 25);
                    
                    // Información del usuario
                    doc.setFillColor(245, 245, 245);
                    doc.roundedRect(margin, 30, contentWidth - qrSize - 5, 30, 3, 3, 'F');
                    
                    doc.setFontSize(12);
                    doc.setTextColor(0, 0, 0);
                    let yPos = 38;
                    
                    // Ajustar ancho de las columnas para dejar espacio al QR
                    const col1 = margin + 5;
                    const col2 = margin + (contentWidth - qrSize - 5) / 2;
                    
                    doc.text(`Nombre: ${currentUser.value.nombre}`, col1, yPos);
                    doc.text(`Cédula: ${currentUser.value.ci}`, col2, yPos);
                    yPos += 7;
                    
                    doc.text(`Código: ${currentUser.value.codigo}`, col1, yPos);
                    doc.text(`Intento: ${attemptNumber.value}`, col2, yPos);
                    yPos += 7;
                    
                    doc.text(`Circunscripción: ${selectedCircunscripcion.value}`, col1, yPos);
                    doc.text(`Fecha: ${new Date().toLocaleDateString()}`, col2, yPos);
                    yPos += 15;
                    
                    // Resultados del examen
                    doc.setFillColor(238, 238, 238);
                    doc.roundedRect(margin, yPos, contentWidth, 15, 3, 3, 'F');
                    doc.setFontSize(14);
                    doc.setTextColor(94, 53, 177);
                    doc.text('Resultados del Examen', margin + 5, yPos + 10);
                    yPos += 20;
                    
                    doc.setFontSize(12);
                    doc.setTextColor(0, 0, 0);
                    
                    doc.text(`Puntuación: ${score.value}%`, col1, yPos);
                    doc.text(`Correctas: ${correctAnswersCount.value} de ${selectedQuestions.value.length}`, col2, yPos);
                    yPos += 7;
                    
                    doc.text(`Tiempo empleado: ${formatTime(elapsedTime.value)}`, col1, yPos);
                    doc.text(`Circunscripción: ${selectedCircunscripcion.value}`, col2, yPos);
                    yPos += 15;
                    
                    // Detalles del examen
                    doc.setFillColor(238, 238, 238);
                    doc.roundedRect(margin, yPos, contentWidth, 15, 3, 3, 'F');
                    doc.setFontSize(14);
                    doc.setTextColor(94, 53, 177);
                    doc.text('Detalles del Examen', margin + 5, yPos + 10);
                    yPos += 20;
                    
                    doc.setFontSize(12);
                    doc.setTextColor(0, 0, 0);
                    
                    doc.text(`Inicio: ${formatDateTime(examStartTime.value)}`, margin, yPos);
                    yPos += 7;
                    
                    doc.text(`Finalización: ${formatDateTime(examFinishTime.value)}`, margin, yPos);
                    yPos += 7;
                    
                    if (examLocation.value) {
                        doc.text(`Ubicación: Lat ${examLocation.value.latitude.toFixed(6)}, Long ${examLocation.value.longitude.toFixed(6)}`, margin, yPos);
                    } else if (locationError.value) {
                        doc.setTextColor(255, 0, 0);
                        doc.text(`Error de ubicación: ${locationError.value}`, margin, yPos);
                        doc.setTextColor(0, 0, 0);
                    }
                    yPos += 7;
                    
                    doc.text(`Dispositivo: ${isMobileDevice.value ? 'Móvil' : 'Computadora'}`, margin, yPos);
                    yPos += 10;
                    
                    // Mapa de ubicación
                    if (examLocation.value) {
                        try {
                            const mapContainer = document.createElement('div');
                            mapContainer.style.width = '600px';
                            mapContainer.style.height = '200px';
                            mapContainer.style.position = 'absolute';
                            mapContainer.style.left = '-9999px';
                            
                            const mapElement = document.createElement('div');
                            mapElement.id = 'pdf-map';
                            mapElement.style.width = '100%';
                            mapElement.style.height = '100%';
                            
                            mapContainer.appendChild(mapElement);
                            document.body.appendChild(mapContainer);
                            
                            const tempMap = L.map('pdf-map', {
                                preferCanvas: true
                            }).setView(
                                [examLocation.value.latitude, examLocation.value.longitude], 
                                16
                            );
                            
                            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                            }).addTo(tempMap);
                            
                            L.marker([examLocation.value.latitude, examLocation.value.longitude])
                                .addTo(tempMap)
                                .bindPopup('Ubicación del examen');
                            
                            await new Promise(resolve => {
                                tempMap.whenReady(() => {
                                    setTimeout(resolve, 500);
                                });
                            });
                            
                            const canvas = await html2canvas(mapContainer, {
                                width: 600,
                                height: 200,
                                scale: 2,
                                logging: false,
                                useCORS: true,
                                backgroundColor: '#ffffff'
                            });
                            
                            const mapImage = canvas.toDataURL('image/png');
                            
                            const imgWidth = contentWidth;
                            const imgHeight = (imgWidth * 200) / 600;
                            
                            doc.addImage(mapImage, 'PNG', margin, yPos, imgWidth, imgHeight);
                            yPos += imgHeight + 5;
                            
                            doc.setFontSize(10);
                            doc.setTextColor(100, 100, 100);
                            doc.text('Ubicación aproximada donde se realizó el examen', pageWidth / 2, yPos, { align: 'center' });
                            yPos += 10;
                            
                            document.body.removeChild(mapContainer);
                        } catch (error) {
                            console.error('Error al generar mapa para PDF:', error);
                        }
                    }
                    
                    // Pie de página
                    doc.setFontSize(10);
                    doc.setTextColor(100, 100, 100);
                    doc.text('Documento generado automáticamente - Sistema de Examen Interactivo', pageWidth / 2, 287, { align: 'center' });
                    
                    // Descargar PDF
                    const filename = `Certificado_Examen_${currentUser.value.nombre.replace(' ', '_')}_${attemptNumber.value}.pdf`;
                    doc.save(filename);
                    
                    showAutoDownloadNotification.value = true;
                    setTimeout(() => {
                        showAutoDownloadNotification.value = false;
                    }, 5000);
                };
                
                const downloadResults = () => {
                    generatePDF().then(() => {
                        showDownloadNotification.value = true;
                        setTimeout(() => {
                            showDownloadNotification.value = false;
                        }, 3000);
                    });
                };
                
                const proccessData = async () => {
                    const examData = {
                        nombre: currentUser.value.nombre,
                        ci: currentUser.value.ci,
                        correo: currentUser.value.correo,
                        codigo: currentUser.value.codigo,
                        nota: score.value,
                        tiempoRespuesta: elapsedTime.value,
                        latitud: examLocation.value?.latitude,
                        longitud: examLocation.value?.longitude,
                        dispositivo: isMobileDevice.value ? 'Móvil' : 'Computadora',
                        circunscripcion: selectedCircunscripcion.value,
                        intento: attemptNumber.value
                    };
                    
                    try {
                        const response = await fetch('https://express-hello-world-dmbr.onrender.com/api/examenes', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(examData)
                        });
                    
                        const data = await response.json();
                        if (data && data._id) {
                            mongoId.value = data.insertedId;
                        }
                    } catch (error) {
                        console.error("Error al enviar datos al servidor:", error);
                    }
                };
                
                const finishExam = async () => {
                    stopTimer();
                    
                    elapsedTime.value = Math.floor((new Date() - examStartedAt.value) / 1000);

                    examFinishTime.value = new Date();
                    currentScreen.value = 'results';
                    lastExamScore.value = score.value;
                    
                    examResults.value = {
                        userId: currentUser.value.codigo,
                        nombre: currentUser.value.nombre,
                        ci: currentUser.value.ci,
                        correo: currentUser.value.correo,
                        attempt: attemptNumber.value,
                        score: score.value,
                        correctAnswers: correctAnswersCount.value,
                        totalQuestions: selectedQuestions.value.length,
                        time: elapsedTime.value,
                        date: new Date().toISOString(),
                        answers: userAnswers.value,
                        startTime: examStartTime.value.toISOString(),
                        finishTime: examFinishTime.value.toISOString(),
                        location: examLocation.value,
                        locationError: locationError.value,
                        deviceType: isMobileDevice.value ? 'Móvil' : 'Computadora',
                        circunscripcion: selectedCircunscripcion.value
                    };
                    
                    Cookies.set(`completed_${currentUser.value.codigo}`, 'true', { expires: 365 });
                    Cookies.set(`results_${currentUser.value.codigo}`, JSON.stringify(examResults.value), { expires: 365 });
                    
                    hasCompletedExam.value = attemptNumber.value >= 2;
                    
                    setTimeout(() => {
                        initLeafletMap();
                    }, 300);
                    
                    await proccessData();
                    
                    await generatePDF();
                };
                
                const returnToStart = () => {
                    finishEF.value = true;
                    currentScreen.value = 'code';
                    selectedCircunscripcion.value = '';
                    examLocation.value = null;
                    locationError.value = null;
                };
                
                const formatDateTime = (date) => {
                    if (!date) return "No disponible";
                    return date.toLocaleString('es-ES', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    });
                };
                
                const toggleAdmin = () => {
                    isAdmin.value = !isAdmin.value;
                    showConfig.value = isAdmin.value;
                    
                    if (isAdmin.value) {
                        currentUser.value = signal.value.find(u => u.codigo === 'ADMIN');
                    } else {
                        currentUser.value = null;
                        currentScreen.value = 'code';
                    }
                };
                
                const saveConfig = () => {
                    showConfig.value = false;
                    if (developmentMode) {
                        localStorage.setItem('examConfig', JSON.stringify(examConfig.value));
                    }
                    alert('Configuración guardada exitosamente');
                };
                
                const formatCountdown = (ms) => {
                    if (ms <= 0) return "00:00:00";
                    const totalSeconds = Math.floor(ms / 1000);
                    const hours = Math.floor(totalSeconds / 3600);
                    const minutes = Math.floor((totalSeconds % 3600) / 60);
                    const seconds = totalSeconds % 60;
                    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                };
                
                const formatTime = (seconds) => {
                    const mins = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                };
                
                const updateTimeUntilStart = () => {
                    const now = new Date();
                    const [startHours, startMins] = examConfig.value.startTime.split(':').map(Number);
                    const [endHours, endMins] = examConfig.value.endTime.split(':').map(Number);
                    
                    const startTime = new Date();
                    startTime.setHours(startHours, startMins, 0, 0);
                    
                    const endTime = new Date();
                    endTime.setHours(endHours, endMins, 0, 0);
                    
                    const newTimeUntilStart = Math.max(0, startTime - now);
                    const newTimeUntilEnd = Math.max(0, endTime - now);
                    
                    if (newTimeUntilStart !== timeUntilStart.value || newTimeUntilEnd !== timeUntilEnd.value) {
                        timeUntilStart.value = newTimeUntilStart;
                        timeUntilEnd.value = newTimeUntilEnd;
                    }
                };
                
                const startTimeChecker = () => {
                    if (timeUpdateInterval.value) {
                        clearInterval(timeUpdateInterval.value);
                    }
                    
                    timeUpdateInterval.value = setInterval(() => {
                        updateTimeUntilStart();
                    }, 1000);
                    
                    updateTimeUntilStart();
                };
                
                const shuffleArray = (array) => {
                    const newArray = [...array];
                    for (let i = newArray.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                    }
                    return newArray;
                };

                // Inicialización
                onMounted(() => {
                    if (developmentMode) {
                        const savedConfig = localStorage.getItem('examConfig');
                        if (savedConfig) {
                            examConfig.value = JSON.parse(savedConfig);
                        }
                    }
                    
                    startTimeChecker();
                    
                    document.addEventListener('keydown', (e) => {
                        if (e.ctrlKey && ['c', 'C', 'x', 'X', 'a', 'A', 'i', 'I'].includes(e.key)) {
                            e.preventDefault();
                        }
                        if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I')) {
                            e.preventDefault();
                        }
                    });
                    
                    document.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                    });
                    
                    document.addEventListener('keydown', (e) => {
                        if (e.ctrlKey && e.shiftKey && e.key === 'J') {
                            e.preventDefault();
                        }
                    });
                    
                    if (isMobileDevice.value) {
                        setTimeout(() => {
                            if (codeInput.value) {
                                codeInput.value.focus({
                                    preventScroll: true
                                });
                                
                                setTimeout(() => {
                                    if (document.activeElement !== codeInput.value) {
                                        codeInput.value.focus();
                                    }
                                }, 300);
                            }
                        }, 800);
                    }
                });

                // Limpieza
                onUnmounted(() => {
                    stopTimer();
                    if (timeUpdateInterval.value) {
                        clearInterval(timeUpdateInterval.value);
                    }
                    if (leafletMap.value) {
                        leafletMap.value.remove();
                    }
                });

                return {
                    currentScreen,
                    enteredCode,
                    isCodeBlocked,
                    countdown,
                    currentUser,
                    selectedQuestions,
                    currentQuestionIndex,
                    selectedAnswers,
                    showFeedback,
                    answerIsFullyCorrect,
                    answerIsPartiallyCorrect,
                    userAnswers,
                    elapsedTime,
                    attemptNumber,
                    isAdmin,
                    showConfig,
                    examConfig,
                    timeLeft,
                    timeUntilStart,
                    timeUntilEnd,
                    hasCompletedExam,
                    lastExamScore,
                    showDownloadNotification,
                    showAutoDownloadNotification,
                    developmentMode,
                    currentQuestion,
                    isLastQuestion,
                    correctAnswersText,
                    correctAnswersCount,
                    score,
                    isExamTime,
                    examLocation,
                    examStartTime,
                    examFinishTime,
                    locationError,
                    currentQuestionImage,
                    showLocationModal,
                    isMobileDevice,
                    codeInput,
                    hiddenInput,
                    selectedCircunscripcion,
                    verifyCode,
                    verifyAndStartExam,
                    requestLocation,
                    cancelExam,
                    startExamAfterLocation,
                    toggleAnswer,
                    checkAnswer,
                    nextQuestion,
                    downloadResults,
                    formatTime,
                    formatCountdown,
                    formatDateTime,
                    toggleAdmin,
                    saveConfig,
                    isQuestionFullyCorrect,
                    handleCodeInput,
                    showKeyboard,
                    returnToStart
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
